admin/contact_enquiries.php

<?php
/*
 * ABIZ Global Services - View Contact Enquiries
 * - Lists all messages from contact form
 * - Allows marking as Read/Unread
 * - Allows deleting enquiries
 */
include_once('header.php'); // Includes session, config, and DB connection

$message = '';
$error = '';

// Function to validate and sanitize IDs
function validate_id($id) {
    return (is_numeric($id) && $id > 0) ? (int)$id : 0;
}

// --- Handle Mark as Read/Unread ---
if (isset($_GET['mark_read'])) {
    $enquiry_id = validate_id($_GET['mark_read']);
    if ($enquiry_id > 0) {
        try {
            $stmt = $db->prepare("UPDATE contact_enquiries SET is_read = 1 WHERE id = ?");
            $stmt->execute([$enquiry_id]);
            $message = "Enquiry marked as read.";
        } catch (PDOException $e) { 
            $error = "Error marking as read: " . $e->getMessage(); 
        }
    } else {
        $error = "Invalid enquiry ID.";
    }
    // Redirect to prevent resubmission
    header("Location: contact_enquiries.php?msg=" . urlencode($message) . "&error=" . urlencode($error));
    exit;
}

if (isset($_GET['mark_unread'])) {
    $enquiry_id = validate_id($_GET['mark_unread']);
    if ($enquiry_id > 0) {
        try {
            $stmt = $db->prepare("UPDATE contact_enquiries SET is_read = 0 WHERE id = ?");
            $stmt->execute([$enquiry_id]);
            $message = "Enquiry marked as unread.";
        } catch (PDOException $e) { 
            $error = "Error marking as unread: " . $e->getMessage(); 
        }
    } else {
        $error = "Invalid enquiry ID.";
    }
    // Redirect to prevent resubmission
    header("Location: contact_enquiries.php?msg=" . urlencode($message) . "&error=" . urlencode($error));
    exit;
}

// --- Handle Delete ---
if (isset($_GET['delete'])) {
    $enquiry_id = validate_id($_GET['delete']);
    if ($enquiry_id > 0) {
        try {
            // Verify enquiry exists before deletion
            $stmt = $db->prepare("SELECT id FROM contact_enquiries WHERE id = ?");
            $stmt->execute([$enquiry_id]);
            $enquiry_exists = $stmt->fetch();
            
            if ($enquiry_exists) {
                $stmt = $db->prepare("DELETE FROM contact_enquiries WHERE id = ?");
                $stmt->execute([$enquiry_id]);
                $message = "Enquiry deleted successfully!";
            } else {
                $error = "Enquiry not found.";
            }
        } catch (PDOException $e) {
            $error = "Error deleting enquiry: ". $e->getMessage();
        }
    } else {
        $error = "Invalid enquiry ID.";
    }
    // Redirect to prevent resubmission
    header("Location: contact_enquiries.php?msg=" . urlencode($message) . "&error=" . urlencode($error));
    exit;
}

// Handle success/error messages from redirects
if (isset($_GET['msg'])) {
    $message = htmlspecialchars($_GET['msg']);
}
if (isset($_GET['error'])) {
    $error = htmlspecialchars($_GET['error']);
}

// --- Fetch all enquiries ---
try {
    $enquiries_stmt = $db->query("SELECT * FROM contact_enquiries ORDER BY received_at DESC");
    $enquiries = $enquiries_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Could not fetch enquiries: " . $e->getMessage();
    $enquiries = [];
}
?>

<!-- Main Content with NEW Animation Class -->
<div class="flex-1 p-6 lg:p-10 fade-in">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6">Contact Form Enquiries</h1>

        <!-- Success/Error Messages -->
        <?php if ($message): ?>
            <div class="bg-green-100 dark:bg-green-800 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
            </div>
        <?php endif; ?>
        <?php if ($error): ?>
            <div class="bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
            </div>
        <?php endif; ?>

        <!-- Enquiries List -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 p-6 border-b border-gray-200 dark:border-gray-700">All Messages</h2>
            <div class="overflow-x-auto">
                <table class="w-full min-w-full">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3 uppercase">From</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3 uppercase">Message</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3 uppercase">Date</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <?php if (empty($enquiries)): ?>
                            <tr>
                                <td colspan="4" class="text-center text-gray-500 px-6 py-4">No enquiries received yet.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($enquiries as $enquiry): ?>
                                <tr class="<?php echo ($enquiry['is_read'] == 0) ? 'bg-blue-50 dark:bg-blue-900/20 font-medium' : 'hover:bg-gray-50 dark:hover:bg-gray-700/50'; ?>">
                                    <td class="px-6 py-4 align-top">
                                        <div class="text-sm text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($enquiry['name']); ?></div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400"><?php echo htmlspecialchars($enquiry['email']); ?></div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400"><?php echo htmlspecialchars($enquiry['phone'] ?? 'N/A'); ?></div>
                                    </td>
                                    <td class="px-6 py-4 align-top">
                                        <div class="text-sm text-gray-600 dark:text-gray-300">
                                            <?php echo nl2br(htmlspecialchars($enquiry['message'])); ?>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 align-top whitespace-nowrap">
                                        <div class="text-sm text-gray-600 dark:text-gray-400">
                                            <?php echo (new DateTime($enquiry['received_at']))->format('d M Y, g:i a'); ?>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 align-top whitespace-nowrap text-sm font-medium">
                                        <?php if ($enquiry['is_read'] == 0): ?>
                                            <a href="contact_enquiries.php?mark_read=<?php echo $enquiry['id']; ?>" class="text-green-600 dark:text-green-400 hover:text-green-300 mr-3" title="Mark as Read">Read</a>
                                        <?php else: ?>
                                            <a href="contact_enquiries.php?mark_unread=<?php echo $enquiry['id']; ?>" class="text-gray-500 dark:text-gray-400 hover:text-gray-300 mr-3" title="Mark as Unread">Unread</a>
                                        <?php endif; ?>
                                        <a href="#" 
                                           class="text-red-600 dark:text-red-400 hover:text-red-300 open-delete-modal"
                                           data-delete-url="contact_enquiries.php?delete=<?php echo $enquiry['id']; ?>"
                                           data-delete-message="Are you sure you want to delete the message from '<?php echo htmlspecialchars($enquiry['name']); ?>'?">
                                           Delete
                                        </a>
                                    </td>
                                 </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<?php
include 'footer.php'; // Include footer
?>

admin/dashboard.php

<?php
session_start();

// Security check - only allow logged-in admins
if (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true || $_SESSION['user_type'] !== 'admin') {
    header("Location: ../login.php");
    exit;
}

require_once '../config/db.php';

// Security headers
header("X-Frame-Options: DENY");
header("X-Content-Type-Options: nosniff");

// Get stats for dashboard
try {
    // Portfolio count
    $stmt = $db->query("SELECT COUNT(*) as count FROM portfolio");
    $portfolio_count = $stmt->fetch()['count'];
    
    // Services count  
    $stmt = $db->query("SELECT COUNT(*) as count FROM services");
    $services_count = $stmt->fetch()['count'];
    
    // Blog posts count
    $stmt = $db->query("SELECT COUNT(*) as count FROM blog_posts WHERE status = 'published'");
    $blog_count = $stmt->fetch()['count'];
    
    // Recent enquiries
    $stmt = $db->query("SELECT * FROM contact_enquiries ORDER BY received_at DESC LIMIT 5");
    $recent_enquiries = $stmt->fetchAll();
    
} catch (PDOException $e) {
    error_log("Dashboard error: " . $e->getMessage());
    $error = "Unable to load dashboard data.";
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ABIZ Global</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-blue-600">ABIZ Admin</h1>
                    <span class="ml-4 text-sm text-gray-600">Portfolio Management System</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-700">Welcome, <?php echo htmlspecialchars($_SESSION['username']); ?></span>
                    <a href="logout.php" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <?php if (isset($error)): ?>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6">
                <?php echo htmlspecialchars($error); ?>
            </div>
        <?php endif; ?>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Portfolio Card -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="bg-blue-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-briefcase text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Portfolio Items</p>
                        <p class="text-2xl font-bold text-gray-900"><?php echo $portfolio_count; ?></p>
                    </div>
                </div>
                <a href="portfolio.php" class="mt-4 inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    Manage Portfolio <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>

            <!-- Services Card -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                <div class="flex items-center">
                    <div class="bg-green-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-cogs text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Services</p>
                        <p class="text-2xl font-bold text-gray-900"><?php echo $services_count; ?></p>
                    </div>
                </div>
                <a href="services.php" class="mt-4 inline-flex items-center text-green-600 hover:text-green-800 text-sm">
                    Manage Services <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>

            <!-- Blog Card -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex items-center">
                    <div class="bg-purple-100 p-3 rounded-lg mr-4">
                        <i class="fas fa-blog text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Blog Posts</p>
                        <p class="text-2xl font-bold text-gray-900"><?php echo $blog_count; ?></p>
                    </div>
                </div>
                <a href="blog.php" class="mt-4 inline-flex items-center text-purple-600 hover:text-purple-800 text-sm">
                    Manage Blog <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>

        <!-- Recent Enquiries -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-800">Recent Contact Enquiries</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <?php foreach ($recent_enquiries as $enquiry): ?>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                <?php echo htmlspecialchars($enquiry['name']); ?>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <?php echo htmlspecialchars($enquiry['email']); ?>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <?php echo htmlspecialchars($enquiry['phone'] ?? 'N/A'); ?>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <?php echo date('M j, Y', strtotime($enquiry['received_at'])); ?>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $enquiry['is_read'] ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'; ?>">
                                    <?php echo $enquiry['is_read'] ? 'Read' : 'New'; ?>
                                </span>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</body>
</html>

admin/footer.php

<?php
/*
 * ABIZ Global Services - Admin Footer
 * - DEEP ANALYSIS FIX:
 * - Main Tailwind CDN script is NOW IN HEADER.
 * - This file (footer) no longer loads tailwind.js
 * - This fixes FOUC and ensures theme toggle works.
 */
?>

            </main> <!-- End Page Content -->
        </div> <!-- End Main Content Area -->
    </div> <!-- End Flex wrapper -->

    <!--
    ======================================
    DELETE CONFIRMATION MODAL
    ======================================
    -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-auto">
            <div class="p-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-800 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fa-solid fa-triangle-exclamation w-6 h-6 text-red-600 dark:text-red-300"></i>
                    </div>
                    <div class="ml-4 text-left">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Delete Confirmation</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="deleteModalMessage">
                                Are you sure you want to delete this? This action cannot be undone.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 px-6 py-4 flex flex-row-reverse rounded-b-lg">
                <a id="deleteModalConfirmButton" href="#" 
                   class="inline-flex justify-center w-full sm:w-auto rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 focus:ring-red-500 sm:ml-3 sm:text-sm">
                   Confirm Delete
                </a>
                <button id="deleteModalCancelButton" type="button" 
                        class="mt-3 sm:mt-0 inline-flex justify-center w-full sm:w-auto rounded-md border border-gray-300 dark:border-gray-500 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 focus:ring-blue-500 sm:text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    <!-- End Delete Modal -->


    <!--
    ======================================
    JAVASCRIPT LIBRARIES (CDN)
    ======================================
    -->
    <script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


    <!--
    ======================================
    NEW, ROBUST SCRIPT EXECUTION
    ======================================
    -->
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. THEME TOGGLE SCRIPT (REMOVED) ---
            // (Theme logic is now 100% in header.php)

            // --- 2. MOBILE SIDEBAR TOGGLE ---
            try {
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const mobileMenuClose = document.getElementById('mobile-menu-close');
                const sidebar = document.getElementById('sidebar');
                const backdrop = document.getElementById('sidebar-backdrop');

                if (mobileMenuToggle && sidebar && backdrop) {
                    mobileMenuToggle.addEventListener('click', () => {
                        sidebar.classList.remove('-translate-x-full');
                        sidebar.classList.add('translate-x-0');
                        backdrop.classList.remove('hidden');
                    });
                }
                
                if (mobileMenuClose && sidebar && backdrop) {
                    const closeSidebar = () => {
                        sidebar.classList.add('-translate-x-full');
                        sidebar.classList.remove('-translate-x-0');
                        backdrop.classList.add('hidden');
                    };
                    mobileMenuClose.addEventListener('click', closeSidebar);
                    backdrop.addEventListener('click', closeSidebar);
                }
                // console.log("Mobile menu initialized.");
            } catch (e) {
                console.error("Mobile menu script failed:", e);
            }

            // --- 3. CUSTOM MODAL SCRIPT ---
            try {
                const deleteModal = document.getElementById('deleteModal');
                const deleteModalMessage = document.getElementById('deleteModalMessage');
                const confirmButton = document.getElementById('deleteModalConfirmButton');
                const cancelButton = document.getElementById('deleteModalCancelButton');

                if (deleteModal) {
                    document.querySelectorAll('.open-delete-modal').forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            const url = e.target.getAttribute('data-delete-url');
                            const message = e.target.getAttribute('data-delete-message');
                            
                            if(confirmButton) confirmButton.href = url;
                            if(deleteModalMessage) deleteModalMessage.textContent = message;
                            deleteModal.classList.remove('hidden');
                        });
                    });

                    if(cancelButton) {
                        cancelButton.addEventListener('click', () => {
                            deleteModal.classList.add('hidden');
                        });
                    }
                }
                // console.log("Modal script initialized.");
            } catch (e) {
                console.error("Modal script failed:", e);
            }

            // --- 4. CKEDITOR INITIALIZATION ---
            try {
                const createEditor = (selector) => {
                    if (document.querySelector(selector) && typeof ClassicEditor !== 'undefined') {
                        ClassicEditor
                            .create(document.querySelector(selector), {
                                toolbar: {
                                    items: ['heading','|','bold','italic','underline','strikethrough','link','|','fontFamily','fontSize','fontColor','fontBackgroundColor','|','bulletedList','numberedList','outdent','indent','|','alignment','|','blockQuote','insertTable','mediaEmbed','|','undo','redo','sourceEditing']
                                },
                                language: 'en',
                                table: {
                                    contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells']
                                }
                            })
                            .catch(error => {
                                console.error(`Error initializing CKEditor on ${selector}:`, error);
                            });
                    }
                };
                createEditor('#portfolio-editor');
                createEditor('#blog-editor');
                // console.log("CKEditor initialization attempted.");
            } catch (e) {
                console.error("CKEditor script failed:", e);
            }

            // --- 5. DATE PICKER & BLOG LOGIC ---
            try {
                // Date Picker
                const publishAtInput = document.getElementById('publish_at');
                if (publishAtInput && typeof flatpickr !== 'undefined') {
                    flatpickr(publishAtInput, {
                        enableTime: true,
                        dateFormat: "Y-m-d H:i:S",
                        time_24hr: true
                    });
                }

                // Blog Status Toggle
                const statusSelect = document.getElementById('blog-status');
                const datePickerContainer = document.getElementById('publish-date-picker');
                if (statusSelect && datePickerContainer) {
                    statusSelect.addEventListener('change', () => {
                        if (statusSelect.value === 'scheduled') {
                            datePickerContainer.classList.remove('hidden');
                        } else {
                            datePickerContainer.classList.add('hidden');
                        }
                    });
                }

                // Slug Generation
                const titleInput = document.getElementById('blog-title');
                const slugInput = document.getElementById('blog-slug');
                if (titleInput && slugInput) {
                    const generateSlug = (str) => {
                        return str.toLowerCase().trim().replace(/[^a-z0-9\s-]/g, '').replace(/[\s_-]+/g, '-').replace(/^-+|-+$/g, '');
                    };
                    titleInput.addEventListener('keyup', () => {
                        slugInput.value = generateSlug(titleInput.value);
                    });
                }
                // console.log("Blog/Date scripts initialized.");
            } catch (e) {
                console.error("Blog/Date scripts failed:", e);
            }

        });
    </script>
    
    <!--
    ======================================
    MAIN TAILWIND SCRIPT (REMOVED FROM HERE)
    ======================================
    -->
    
</body>
</html>

admin/header.php

<?php
/*
 * ABIZ Global Services - Admin Header
 * - FINAL THEME & FOUC FIX
 * - SOLUTION: Adding Tailwind 'safelist' to force generation of dark mode CSS.
 */

session_start();

// If admin is not logged in, redirect to login page
if (!isset($_SESSION['admin_user']) && basename($_SERVER['PHP_SELF']) !== 'index.php') {
    header("Location: index.php");
    exit;
}

if (file_exists('../config.php')) {
    require_once '../config.php';
} else {
    if (basename($_SERVER['PHP_SELF']) !== 'index.php') {
        die("Configuration file is missing. Please run the installer.");
    }
}

// Fetch site title
$site_title = 'ABIZ Global Services';
if (isset($db)) {
    try {
        $stmt = $db->query("SELECT site_title FROM site_settings WHERE id = 1");
        $result = $stmt->fetch(PDO::FETCH_ASSOC);
        if ($result && !empty($result['site_title'])) {
            $site_title = $result['site_title'];
        }
    } catch (PDOException $e) { /* Silently fail */ }
}

// Fetch unread enquiries count
$unread_count = 0;
if (isset($db)) {
    try {
        $stmt_count = $db->query("SELECT COUNT(*) FROM contact_enquiries WHERE is_read = 0");
        $unread_count = $stmt_count->fetchColumn();
    } catch (PDOException $e) { /* Silently fail */ }
}

$current_page = basename($_SERVER['PHP_SELF']);

// Define navigation items
$nav_items = [
    'Content' => [
        'dashboard.php' => ['name' => 'Dashboard', 'icon' => 'fa-solid fa-home'],
        'manage_services.php' => ['name' => 'Services', 'icon' => 'fa-solid fa-briefcase'],
        'manage_portfolio.php' => ['name' => 'Portfolio', 'icon' => 'fa-solid fa-image'],
        'manage_products.php' => ['name' => 'Products', 'icon' => 'fa-solid fa-shopping-cart'],
        'manage_blog.php' => ['name' => 'Blog', 'icon' => 'fa-solid fa-file-text'],
    ],
    'Admin' => [
        'contact_enquiries.php' => ['name' => 'Enquiries', 'icon' => 'fa-solid fa-mail-bulk', 'count' => $unread_count],
        'site_settings.php' => ['name' => 'Site Settings', 'icon' => 'fa-solid fa-cog'],
    ]
];
?>
<!DOCTYPE html>
<html lang="en" class="h-full"> <!-- <html> tag se class applyInitialTheme() script set karega -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - <?php echo htmlspecialchars($site_title); ?></title>
    
    <!--
    ======================================
    THEME FIX: TAILWIND CONFIG & SCRIPT (JIT FORCING)
    ======================================
    -->
    <script>
        // 1. Config (JIT FORCING SAFELIST)
        tailwind.config = {
            darkMode: 'class', // YEH BOHAT ZAROORI HAI
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'], 
                    }
                }
            },
            // ************ THE FINAL FIX: SAFELISTING KEY DARK CLASSES ************
            // This forces Tailwind's JIT compiler to generate the CSS for these classes 
            // even if they haven't rendered on the page yet, guaranteeing the toggle works.
            safelist: [
                'bg-gray-900', 'bg-gray-800', 'bg-gray-700', 'bg-gray-600',
                'bg-white', 'text-white', 'text-gray-900', 'text-gray-200',
                'dark:bg-gray-900', 'dark:bg-gray-800', 'dark:bg-gray-700', 'dark:bg-gray-600',
                'dark:text-white', 'dark:text-gray-200', 'dark:text-gray-300', 'dark:text-gray-400',
                'dark:border-gray-700', 'dark:hover:bg-gray-700', 'dark:hover:text-white',
                'dark:focus:ring-offset-gray-800', 'dark:bg-blue-600', 'dark:text-blue-400',
                'dark:bg-blue-900/20', 'bg-blue-50', 'text-blue-600'
            ]
        }
        
        // 2. Initial Theme Loader (FOUC Fix)
        const html = document.documentElement;
        function applyInitialTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                html.classList.remove('dark');
            } else if (savedTheme === 'dark') {
                html.classList.add('dark');
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
        }
        applyInitialTheme(); // Run immediately
        
        // 3. Click Toggle Function (ASAL FIX YAHAN HAI)
        function toggleTheme(event) {
            if(event) event.preventDefault();
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark'); 
            }
        }
    </script>
    
    <!-- 4. Main Tailwind Script (MOVED BACK TO HEAD) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Other CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; } 
        /* Scrollbar styles */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark ::-webkit-scrollbar-track { background: #2d3748; }
        .dark ::-webkit-scrollbar-thumb { background: #718096; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }
        /* Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="h-full flex bg-gray-100 dark:bg-gray-900"> <!-- Dummy dark: class forces JIT -->

    <!-- Mobile Sidebar Backdrop -->
    <div id="sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

    <!-- 
    ======================================
    SIDEBAR
    ======================================
    -->
    <aside id="sidebar" 
           class="fixed inset-y-0 left-0 w-64 shadow-xl z-30
                  bg-white text-gray-600 dark:bg-gray-900 dark:text-gray-300
                  transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
        
        <div class="h-full flex flex-col">
            <!-- Logo -->
            <div class="h-16 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700">
                <a href="dashboard.php" class="text-xl font-bold text-blue-600 dark:text-white whitespace-nowrap overflow-hidden">
                    <?php echo htmlspecialchars($site_title); ?>
                </a>
                <!-- Mobile Close Button -->
                <button id="mobile-menu-close" class="md:hidden text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white">
                    <i class="fa-solid fa-times w-6 h-6"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto px-2 py-4 space-y-4">
                <?php foreach ($nav_items as $group_title => $items): ?>
                    <div>
                        <h3 class="px-4 mb-2 text-xs font-semibold uppercase text-gray-400 dark:text-gray-500 tracking-wider">
                            <?php echo $group_title; ?>
                        </h3>
                        <div class="space-y-1">
                            <?php foreach ($items as $link => $details): ?>
                                <?php 
                                    $is_active = ($current_page == $link);
                                    if (str_starts_with($current_page, 'manage_') && (isset($_GET['action']) || isset($_GET['edit'])) && str_starts_with($link, 'manage_')) {
                                        $is_active = (explode('?', $current_page)[0] == $link);
                                    }
                                ?>
                                <a href="<?php echo $link; ?>" 
                                   class="flex items-center px-4 py-2.5 rounded-lg text-sm font-medium
                                          transition-colors duration-150
                                          <?php echo $is_active 
                                                ? 'bg-blue-50 text-blue-600 dark:bg-blue-600 dark:text-white font-semibold shadow-sm' 
                                                : 'hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-white';
                                          ?>">
                                    <i class="<?php echo $details['icon']; ?> w-5 h-5 mr-3"></i>
                                    <span class="flex-1"><?php echo $details['name']; ?></span>
                                    <?php if (isset($details['count']) && $details['count'] > 0): ?>
                                        <span class="ml-auto bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">
                                            <?php echo $details['count']; ?>
                                        </span>
                                    <?php endif; ?>
                                </a>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endforeach; ?>
            </nav>

            <!-- User Info -->
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                         <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center">
                            <i class="fa-solid fa-user w-6 h-6 text-white"></i>
                         </div>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">
                            <?php echo htmlspecialchars($_SESSION['admin_user']); ?>
                        </p>
                        <a href="logout.php" class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white">
                            Log Out
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col md:ml-64">
        
        <!-- Mobile Top Bar -->
        <header class="md:hidden sticky top-0 bg-white dark:bg-gray-800 shadow-md z-10">
            <div class="flex items-center justify-between h-16 px-4">
                <button id="mobile-menu-toggle" class="text-gray-600 dark:text-gray-300">
                    <i class="fa-solid fa-bars w-6 h-6"></i>
                </button>
                <a href="dashboard.php" class="text-lg font-bold text-blue-600 dark:text-blue-400">
                    <?php echo htmlspecialchars($site_title); ?>
                </a>
                <!-- ONCLICK attribute added -->
                <button onclick="toggleTheme(event)" class="p-2 rounded-lg text-gray-600 dark:text-gray-300">
                    <i class="fa-solid fa-sun w-5 h-5 hidden dark:inline"></i>
                    <i class="fa-solid fa-moon w-5 h-5 inline dark:hidden"></i>
                </button>
            </div>
        </header>
        
        <!-- Desktop Top Bar -->
        <header class="hidden md:flex items-center justify-end h-16 sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 z-10">
            <div classs="flex items-center space-x-4">
                <!-- ONCLICK attribute added -->
                <button onclick="toggleTheme(event)" class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i class="fa-solid fa-sun w-5 h-5 hidden dark:inline"></i>
                    <i class="fa-solid fa-moon w-5 h-5 inline dark:hidden"></i>
                </button>
                <a href="<?php echo defined('SITE_URL') ? rtrim(SITE_URL, '/') : '..'; ?>/" target="_blank" 
                   class="inline-flex items-center text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300">
                    View Website
                    <i class="fa-solid fa-external-link w-4 h-4 ml-1.5"></i>
                </a>
            </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 overflow-y-auto p-6">
            <!-- Content begins here -->

admin/index.php

<?php
/**
 * Admin Login Page - Original Design Preserved
 * File: admin/index.php
 * Only fixes: Added config.php include and $db connection
 */

// Start session
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Redirect if already logged in
if (isset($_SESSION['admin_user_id']) && isset($_SESSION['logged_in'])) {
    header("Location: dashboard.php");
    exit;
}

// CRITICAL FIX: Include database configuration
if (file_exists('../config.php')) {
    require_once '../config.php';
    $db = $pdo; // Create $db alias for compatibility
} else {
    die("Database configuration not found. Please run the installer first. <a href='../install/install.php'>Install Now</a>");
}

$error = '';
$success = '';

// Generate CSRF token
if (empty($_SESSION['login_csrf_token'])) {
    $_SESSION['login_csrf_token'] = bin2hex(random_bytes(32));
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $csrf_token = $_POST['csrf_token'] ?? '';
    
    if (empty($csrf_token) || $csrf_token !== $_SESSION['login_csrf_token']) {
        $error = "Security validation failed. Please try again.";
    } else {
        $username = trim($_POST['username'] ?? '');
        $password = trim($_POST['password'] ?? '');
        
        if (empty($username) || empty($password)) {
            $error = "Username and password are required.";
        } elseif (strlen($username) > 100) {
            $error = "Invalid username format.";
        } else {
            try {
                $stmt = $db->prepare("SELECT * FROM admin_users WHERE username = ?");
                $stmt->execute([$username]);
                $user = $stmt->fetch(PDO::FETCH_ASSOC);
                
                if ($user && password_verify($password, $user['password'])) {
                    // Password is correct! Start the session securely
                    session_regenerate_id(true);
                    $_SESSION['admin_user_id'] = $user['id'];
                    $_SESSION['admin_user'] = $user['username'];
                    $_SESSION['logged_in'] = true;
                    $_SESSION['last_activity'] = time();
                    
                    // Clear CSRF token after successful login
                    unset($_SESSION['login_csrf_token']);
                    
                    // Log login activity
                    error_log("Admin login successful: " . $username . " from " . $_SERVER['REMOTE_ADDR']);
                    
                    header("Location: dashboard.php");
                    exit;
                } else {
                    $error = "Invalid username or password.";
                    // Log failed login attempt
                    error_log("Failed admin login attempt: " . $username . " from " . $_SERVER['REMOTE_ADDR']);
                }
            } catch (PDOException $e) {
                error_log("Login database error: " . $e->getMessage());
                $error = "Database error. Please try again later.";
            }
        }
    }
}

// Get Site Title for Login Page
try {
    $stmt = $db->query("SELECT site_title FROM site_settings WHERE id = 1");
    $settings = $stmt->fetch(PDO::FETCH_ASSOC);
    $site_title = $settings['site_title'] ?? 'ABIZ Global Services';
} catch (PDOException $e) {
    $site_title = 'ABIZ Global Services';
}

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-wrapper {
            width: 100%;
            max-width: 420px;
        }
        
        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .login-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px 30px;
            text-align: center;
        }
        
        .login-header h3 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .login-header p {
            margin: 8px 0 0;
            opacity: 0.95;
            font-size: 15px;
        }
        
        .login-body {
            padding: 40px 30px;
        }
        
        .form-floating {
            margin-bottom: 20px;
        }
        
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px 18px;
            height: 55px;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.15);
        }
        
        .form-floating > label {
            padding: 1rem 1.125rem;
            color: #6c757d;
        }
        
        .btn-login {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .alert {
            border-radius: 10px;
            margin-bottom: 20px;
            border: none;
            padding: 12px 16px;
        }
        
        .alert-danger {
            background: #fee;
            color: #c33;
        }
        
        .alert-success {
            background: #efe;
            color: #3a3;
        }
        
        .installer-link {
            text-align: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #e9ecef;
        }
        
        .installer-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .installer-link a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        
        .form-check {
            margin-bottom: 15px;
        }
        
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6c757d;
            z-index: 10;
        }
        
        .password-wrapper {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="login-wrapper">
        <div class="login-card">
            <!-- Login Header -->
            <div class="login-header">
                <h3><i class="fas fa-lock"></i> Admin Panel Login</h3>
                <p><?php echo htmlspecialchars($site_title); ?></p>
            </div>
            
            <!-- Login Body -->
            <div class="login-body">
                <!-- Error Message -->
                <?php if ($error): ?>
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <?php echo htmlspecialchars($error); ?>
                    </div>
                <?php endif; ?>
                
                <!-- Success Message -->
                <?php if ($success): ?>
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> 
                        <?php echo htmlspecialchars($success); ?>
                    </div>
                <?php endif; ?>
                
                <!-- Login Form -->
                <form method="POST" autocomplete="off">
                    <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($_SESSION['login_csrf_token']); ?>">
                    
                    <!-- Username -->
                    <div class="form-floating mb-3">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="username" 
                            name="username" 
                            placeholder="Username"
                            required
                            autofocus
                        >
                        <label for="username"><i class="fas fa-user"></i> Username</label>
                    </div>
                    
                    <!-- Password -->
                    <div class="password-wrapper">
                        <div class="form-floating mb-3">
                            <input 
                                type="password" 
                                class="form-control" 
                                id="password" 
                                name="password" 
                                placeholder="Password"
                                required
                            >
                            <label for="password"><i class="fas fa-key"></i> Password</label>
                        </div>
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-login">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                
                <!-- Installer Link -->
                <div class="installer-link">
                    <small>
                        First time setup? 
                        <a href="../install/install.php">
                            <i class="fas fa-cog"></i> Run Installer
                        </a>
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Password toggle
        const togglePassword = document.getElementById('togglePassword');
        const password = document.getElementById('password');
        
        if (togglePassword) {
            togglePassword.addEventListener('click', function() {
                const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
                password.setAttribute('type', type);
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

admin/login.php

<?php
session_start();
require_once 'config/db.php';

$error = '';
$success = '';

// CSRF Protection
if (!isset($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    
    // CSRF Validation
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        $error = "Security token invalid. Please try again.";
    } else {
        // Sanitize inputs
        $username = sanitize_input($_POST['username'] ?? '');
        $password = $_POST['password'] ?? '';

        // Validation
        if (empty($username) || empty($password)) {
            $error = "Please enter both username and password.";
        } else {
            try {
                // Secure query with prepared statement
                $stmt = $db->prepare("SELECT * FROM admin_users WHERE username = ? LIMIT 1");
                $stmt->execute([$username]);
                $admin = $stmt->fetch();

                if ($admin && password_verify($password, $admin['password'])) {
                    // Login successful - set secure session
                    $_SESSION['admin_id'] = $admin['id'];
                    $_SESSION['username'] = $admin['username'];
                    $_SESSION['user_type'] = 'admin';
                    $_SESSION['logged_in'] = true;
                    
                    // Regenerate session ID to prevent fixation
                    session_regenerate_id(true);
                    
                    // Clear CSRF token
                    unset($_SESSION['csrf_token']);
                    
                    $success = "Login successful! Redirecting to admin panel...";
                    header("Refresh: 2; URL=admin/dashboard.php");
                    exit;
                } else {
                    $error = "Invalid username or password.";
                }

            } catch (PDOException $e) {
                error_log("Login error: " . $e->getMessage());
                $error = "System error. Please try again later.";
            }
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - ABIZ Global Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-600">ABIZ Global</h1>
                <p class="text-gray-600 mt-2">Admin Panel Login</p>
            </div>

            <!-- Error/Success Messages -->
            <?php if ($error): ?>
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <?php echo htmlspecialchars($error); ?>
                </div>
            <?php endif; ?>
            
            <?php if ($success): ?>
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6">
                    <i class="fas fa-check-circle mr-2"></i>
                    <?php echo htmlspecialchars($success); ?>
                </div>
            <?php endif; ?>

            <!-- Login Form -->
            <form method="POST" action="" class="space-y-6">
                <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">
                
                <!-- Username -->
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" name="username" id="username" 
                           value="<?php echo htmlspecialchars($_POST['username'] ?? ''); ?>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                           placeholder="Enter admin username" required>
                </div>

                <!-- Password -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" name="password" id="password" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                           placeholder="Enter admin password" required>
                </div>

                <!-- Submit Button -->
                <button type="submit" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In to Admin Panel
                </button>
            </form>

            <!-- Installer Link -->
            <div class="mt-6 text-center">
                <p class="text-gray-600 text-sm">
                    First time setup? 
                    <a href="install/index.php" class="text-blue-600 hover:text-blue-800 font-medium">
                        Run Installer
                    </a>
                </p>
            </div>
        </div>
    </div>
</body>
</html>

admin/logout.php

<?php
/**
 * Admin Logout Handler
 * File: admin/logout.php
 * Description: Securely destroys user session and clears all session data
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Security: Log logout activity
$admin_id = $_SESSION['admin_user_id'] ?? null;
if ($admin_id && isset($_SESSION['admin_user'])) {
    // Log can be written to database if needed
    error_log("Admin logout: " . $_SESSION['admin_user'] . " from " . $_SERVER['REMOTE_ADDR']);
}

// Destroy all session data
$_SESSION = [];

// Delete the session cookie
if (ini_get("session.use_cookies")) {
    $params = session_get_cookie_params();
    setcookie(
        session_name(),
        '',
        time() - 42000,
        $params["path"],
        $params["domain"],
        $params["secure"],
        $params["httponly"]
    );
}

// Destroy the session
session_destroy();

// Redirect to login page with success message
header("Location: index.php?logout=success");
exit();
?>

admin/manage_blog.php

<?php
include_once('header.php');

define('BLOG_UPLOAD_PATH', '../uploads/blog/');
if (!is_dir(BLOG_UPLOAD_PATH)) {
    mkdir(BLOG_UPLOAD_PATH, 0777, true);
}

$message = '';
$error = '';
$edit_id = null;
$edit_data = ['title' => '', 'content' => '', 'slug' => '', 'status' => 'published', 'publish_at' => '', 'image_path' => '', 'seo_title' => '', 'seo_desc' => '', 'seo_keywords' => ''];
$form_mode = 'add';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $title = trim($_POST['title'] ?? '');
    $content = trim($_POST['content'] ?? '');
    $slug = trim($_POST['slug'] ?? '');
    $status = $_POST['status'] ?? 'published';
    $publish_at = $_POST['publish_at'] ?? null;
    $seo_title = trim($_POST['seo_title'] ?? '');
    $seo_desc = trim($_POST['seo_desc'] ?? '');
    $seo_keywords = trim($_POST['seo_keywords'] ?? '');
    $mode = $_POST['mode'] ?? 'add';
    $id = $_POST['id'] ?? null;
    $current_image = $_POST['current_image'] ?? '';

    if (empty($title) || empty($content) || empty($slug)) {
        $error = "Title, Content, and Permalink are required.";
    } else {
        if ($status !== 'scheduled') {
            $publish_at = null;
        }

        $image_path = $current_image;
        
        if (isset($_FILES['post_image']) && $_FILES['post_image']['error'] == 0) {
            $allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            $file_type = $_FILES['post_image']['type'];

            if (in_array($file_type, $allowed_types)) {
                $file_ext = pathinfo($_FILES['post_image']['name'], PATHINFO_EXTENSION);
                $new_filename = uniqid('blog_', true) . '.' . $file_ext;
                $target_path = BLOG_UPLOAD_PATH . $new_filename;

                if (move_uploaded_file($_FILES['post_image']['tmp_name'], $target_path)) {
                    if ($current_image && file_exists(BLOG_UPLOAD_PATH . $current_image)) {
                        @unlink(BLOG_UPLOAD_PATH . $current_image);
                    }
                    $image_path = $new_filename;
                } else {
                    $error = "Failed to move uploaded file.";
                }
            } else {
                $error = "Invalid file type. Only JPEG, PNG, GIF, WEBP allowed.";
            }
        }

        if (empty($error)) {
            try {
                if ($mode === 'add') {
                    $stmt = $db->prepare("INSERT INTO blog_posts (title, content, slug, status, publish_at, image_path, seo_title, seo_desc, seo_keywords) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)");
                    $stmt->execute([$title, $content, $slug, $status, $publish_at, $image_path, $seo_title, $seo_desc, $seo_keywords]);
                    $message = "Post added successfully!";
                } elseif ($mode === 'edit' && $id) {
                    $stmt = $db->prepare("UPDATE blog_posts SET title = ?, content = ?, slug = ?, status = ?, publish_at = ?, image_path = ?, seo_title = ?, seo_desc = ?, seo_keywords = ? WHERE id = ?");
                    $stmt->execute([$title, $content, $slug, $status, $publish_at, $image_path, $seo_title, $seo_desc, $seo_keywords, $id]);
                    $message = "Post updated successfully!";
                }
            } catch (PDOException $e) {
                if ($e->getCode() == '23000') {
                    $error = "Permalink/Slug already exists. Please choose a unique permalink.";
                } else {
                    $error = "Database error: " . $e->getMessage();
                }
            }
        }
    }
}

if (isset($_GET['action']) && $_GET['action'] === 'edit' && isset($_GET['id'])) {
    $edit_id = $_GET['id'];
    try {
        $stmt = $db->prepare("SELECT * FROM blog_posts WHERE id = ?");
        $stmt->execute([$edit_id]);
        $edit_data = $stmt->fetch(PDO::FETCH_ASSOC);
        if ($edit_data) {
            $form_mode = 'edit';
        } else {
            $error = "Post not found.";
            $edit_id = null;
        }
    } catch (PDOException $e) {
        $error = "Database error: " . $e->getMessage();
        $edit_id = null;
    }
}

if (isset($_GET['delete'])) {
    try {
        $stmt = $db->prepare("SELECT image_path FROM blog_posts WHERE id = ?");
        $stmt->execute([$_GET['delete']]);
        $post = $stmt->fetch(PDO::FETCH_ASSOC);

        $stmt = $db->prepare("DELETE FROM blog_posts WHERE id = ?");
        $stmt->execute([$_GET['delete']]);
        
        if ($post && $post['image_path'] && file_exists(BLOG_UPLOAD_PATH . $post['image_path'])) {
            @unlink(BLOG_UPLOAD_PATH . $post['image_path']);
        }
        
        $message = "Post deleted successfully!";
        header("Location: manage_blog.php");
        exit;
    } catch (PDOException $e) {
        $error = "Error deleting post: ". $e->getMessage();
    }
}

try {
    $posts_stmt = $db->query("SELECT * FROM blog_posts ORDER BY created_at DESC");
    $posts = $posts_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Could not fetch posts: " . $e->getMessage();
    $posts = [];
}
?>

<div class="flex-1 p-6 lg:p-10 fade-in">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6 flex justify-between items-center">
            Manage Blog Posts
            <a href="manage_blog.php?action=add" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500">
                Add New Post
            </a>
        </h1>

        <?php if ($message): ?>
            <div class="bg-green-100 dark:bg-green-800 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
            </div>
        <?php endif; ?>
        <?php if ($error): ?>
            <div class="bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
            </div>
        <?php endif; ?>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">
                <?php echo ($form_mode === 'edit' ? 'Edit Post: ' . htmlspecialchars($edit_data['title']) : 'Add New Post'); ?>
            </h2>
            <form action="manage_blog.php" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="mode" value="<?php echo $form_mode; ?>">
                <?php if ($form_mode === 'edit'): ?>
                    <input type="hidden" name="id" value="<?php echo htmlspecialchars($edit_id); ?>">
                    <input type="hidden" name="current_image" value="<?php echo htmlspecialchars($edit_data['image_path']); ?>">
                <?php endif; ?>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <div class="mb-4">
                            <label for="blog-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Post Title</label>
                            <input type="text" name="title" id="blog-title" required value="<?php echo htmlspecialchars($edit_data['title']); ?>"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                          bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                          focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label for="blog-editor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Blog Content</label>
                            <textarea name="content" id="blog-editor" rows="15" required
                                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                             bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                             focus:outline-none focus:ring-2 focus:ring-blue-500"><?php echo htmlspecialchars($edit_data['content']); ?></textarea>
                        </div>
                    </div>

                    <div class="md:col-span-1">
                        <div class="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3">Settings</h3>
                            <div class="mb-4">
                                <label for="blog-slug" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Permalink (Slug)</label>
                                <input type="text" name="slug" id="blog-slug" required value="<?php echo htmlspecialchars($edit_data['slug']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                              focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">This will be used in the URL (e.g., /blog/post-slug).</p>
                            </div>
                            <div class="mb-4">
                                <label for="blog-status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                                <select name="status" id="blog-status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200">
                                    <option value="published" <?php echo ($edit_data['status'] == 'published') ? 'selected' : ''; ?>>Published</option>
                                    <option value="draft" <?php echo ($edit_data['status'] == 'draft') ? 'selected' : ''; ?>>Draft</option>
                                    <option value="scheduled" <?php echo ($edit_data['status'] == 'scheduled') ? 'selected' : ''; ?>>Scheduled</option>
                                </select>
                            </div>
                            <div id="publish-date-picker" class="mb-4 <?php echo ($edit_data['status'] !== 'scheduled') ? 'hidden' : ''; ?>">
                                <label for="publish_at" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Publish Date & Time</label>
                                <input type="text" name="publish_at" id="publish_at" value="<?php echo htmlspecialchars($edit_data['publish_at']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                              focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="YYYY-MM-DD HH:MM:SS">
                            </div>
                        </div>

                        <div class="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3">Image & SEO</h3>
                            <div class="mb-4">
                                <label for="post_image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Featured Image (JPEG, PNG, WEBP)</label>
                                <input type="file" name="post_image" id="post_image" class="w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-800 file:text-blue-700 dark:file:text-blue-200 hover:file:bg-blue-100 dark:hover:file:bg-blue-700">
                                <?php if ($form_mode === 'edit' && $edit_data['image_path']): ?>
                                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Current Image:</p>
                                    <img src="<?php echo BLOG_UPLOAD_PATH . htmlspecialchars($edit_data['image_path']); ?>" alt="Featured Image" class="mt-2 h-20 w-auto object-cover rounded-lg shadow">
                                <?php endif; ?>
                            </div>
                            <div class="mb-4">
                                <label for="seo_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Title</label>
                                <input type="text" name="seo_title" id="seo_title" value="<?php echo htmlspecialchars($edit_data['seo_title']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200">
                            </div>
                            <div class="mb-4">
                                <label for="seo_desc" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Description</label>
                                <textarea name="seo_desc" id="seo_desc" rows="3"
                                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                                 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($edit_data['seo_desc']); ?></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="seo_keywords" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Keywords</label>
                                <input type="text" name="seo_keywords" id="seo_keywords" value="<?php echo htmlspecialchars($edit_data['seo_keywords']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                                       placeholder="e.g., web design, seo, marketing, case study">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6 border-t border-gray-200 dark:border-gray-700 pt-4">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded-lg
                                   shadow-md transition-colors duration-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        <?php echo ($form_mode === 'edit' ? 'Update Post' : 'Add Post'); ?>
                    </button>
                    <?php if ($form_mode === 'edit'): ?>
                        <a href="manage_blog.php" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-5 rounded-lg shadow-md transition-colors duration-200 flex items-center">
                            Cancel Edit
                        </a>
                    <?php endif; ?>
                </div>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 p-6 border-b border-gray-200 dark:border-gray-700">Existing Posts</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Title & Permalink</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Status</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Publish Date</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <?php if (empty($posts)): ?>
                            <tr>
                                <td colspan="4" class="text-center text-gray-500 px-6 py-4">No blog posts added yet.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($posts as $post): ?>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="text-sm font-medium text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($post['title']); ?></div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400 max-w-sm truncate">/blog/<?php echo htmlspecialchars($post['slug']); ?></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <?php
                                            $status_class = [
                                                'published' => 'bg-green-100 text-green-800 dark:bg-green-700/50 dark:text-green-200',
                                                'draft' => 'bg-gray-100 text-gray-800 dark:bg-gray-700/50 dark:text-gray-200',
                                                'scheduled' => 'bg-yellow-100 text-yellow-800 dark:bg-yellow-700/50 dark:text-yellow-200'
                                            ][$post['status']] ?? 'bg-gray-100 text-gray-800';
                                        ?>
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $status_class; ?>">
                                            <?php echo ucfirst($post['status']); ?>
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <?php if ($post['publish_at']): ?>
                                            <?php echo (new DateTime($post['publish_at']))->format('d M Y, h:i a'); ?>
                                        <?php else: ?>
                                            N/A
                                        <?php endif; ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="manage_blog.php?action=edit&id=<?php echo $post['id']; ?>" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-3">
                                            Edit
                                        </a>
                                        <a href="#" 
                                           class="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 open-delete-modal"
                                           data-delete-url="manage_blog.php?delete=<?php echo $post['id']; ?>"
                                           data-delete-message="Are you sure you want to delete the post '<?php echo htmlspecialchars($post['title']); ?>'? This will also delete the image.">
                                           Delete
                                        </a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<?php
include 'footer.php';
?>

admin/manage_portfolio.php

<?php
include_once('header.php');

define('PORTFOLIO_UPLOAD_PATH', '../uploads/portfolio/');
if (!is_dir(PORTFOLIO_UPLOAD_PATH)) {
    mkdir(PORTFOLIO_UPLOAD_PATH, 0777, true);
}

$message = '';
$error = '';
$edit_id = null;
$edit_data = ['title' => '', 'description' => '', 'image_path' => '', 'client_name' => '', 'client_review' => '', 'rating' => 5, 'seo_title' => '', 'seo_desc' => '', 'seo_keywords' => '', 'services_used' => []];
$form_mode = 'add';

// Function to validate and sanitize file uploads
function validate_uploaded_file($file) {
    $errors = [];
    
    // Check if file was uploaded without errors
    if ($file['error'] !== UPLOAD_ERR_OK) {
        $errors[] = "File upload error: " . $file['error'];
        return [false, $errors];
    }
    
    // Check file size (max 5MB)
    $max_size = 5 * 1024 * 1024;
    if ($file['size'] > $max_size) {
        $errors[] = "File size must be less than 5MB.";
    }
    
    // Check file type
    $allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
    $file_type = mime_content_type($file['tmp_name']);
    if (!in_array($file_type, $allowed_types)) {
        $errors[] = "Invalid file type. Only JPEG, PNG, GIF, WEBP allowed.";
    }
    
    // Check file extension
    $allowed_extensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
    $file_extension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    if (!in_array($file_extension, $allowed_extensions)) {
        $errors[] = "Invalid file extension. Only JPG, JPEG, PNG, GIF, WEBP allowed.";
    }
    
    return [empty($errors), $errors];
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $title = trim($_POST['title'] ?? '');
    $description = trim($_POST['description'] ?? '');
    $client_name = trim($_POST['client_name'] ?? '');
    $client_review = trim($_POST['client_review'] ?? '');
    $rating = (int)($_POST['rating'] ?? 5);
    $seo_title = trim($_POST['seo_title'] ?? '');
    $seo_desc = trim($_POST['seo_desc'] ?? '');
    $seo_keywords = trim($_POST['seo_keywords'] ?? '');
    $services_used = $_POST['services_used'] ?? [];
    $mode = $_POST['mode'] ?? 'add';
    $id = $_POST['id'] ?? null;
    $current_image = $_POST['current_image'] ?? '';

    // Input validation
    if (empty($title) || empty($description)) {
        $error = "Project Title and Case Study Description are required.";
    } elseif (strlen($title) > 255) {
        $error = "Project Title must be less than 255 characters.";
    } elseif ($rating < 1 || $rating > 5) {
        $error = "Rating must be between 1 and 5.";
    } else {
        $image_path = $current_image;

        // Handle file upload with validation
        if (isset($_FILES['project_image']) && $_FILES['project_image']['error'] == UPLOAD_ERR_OK) {
            list($is_valid, $upload_errors) = validate_uploaded_file($_FILES['project_image']);
            
            if (!$is_valid) {
                $error = implode(" ", $upload_errors);
            } else {
                $file_ext = strtolower(pathinfo($_FILES['project_image']['name'], PATHINFO_EXTENSION));
                $new_filename = uniqid('port_', true) . '.' . $file_ext;
                $target_path = PORTFOLIO_UPLOAD_PATH . $new_filename;

                if (move_uploaded_file($_FILES['project_image']['tmp_name'], $target_path)) {
                    // Delete old image if it exists and we're updating
                    if ($current_image && file_exists(PORTFOLIO_UPLOAD_PATH . $current_image)) {
                        @unlink(PORTFOLIO_UPLOAD_PATH . $current_image);
                    }
                    $image_path = $new_filename;
                } else {
                    $error = "Failed to move uploaded file. Please check folder permissions.";
                }
            }
        } elseif (isset($_FILES['project_image']) && $_FILES['project_image']['error'] != UPLOAD_ERR_NO_FILE) {
            // Handle specific upload errors
            $upload_errors = [
                UPLOAD_ERR_INI_SIZE => "The uploaded file exceeds the upload_max_filesize directive in php.ini.",
                UPLOAD_ERR_FORM_SIZE => "The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form.",
                UPLOAD_ERR_PARTIAL => "The uploaded file was only partially uploaded.",
                UPLOAD_ERR_NO_TMP_DIR => "Missing a temporary folder.",
                UPLOAD_ERR_CANT_WRITE => "Failed to write file to disk.",
                UPLOAD_ERR_EXTENSION => "A PHP extension stopped the file upload."
            ];
            $error = $upload_errors[$_FILES['project_image']['error']] ?? "Unknown upload error.";
        }

        if (empty($error)) {
            try {
                $db->beginTransaction();
                $last_id = null;

                // Sanitize services_used array - ensure they are integers
                $sanitized_services = array_filter(array_map('intval', $services_used));

                if ($mode === 'add') {
                    $stmt = $db->prepare("INSERT INTO portfolio (title, description, image_path, client_name, client_review, rating, seo_title, seo_desc, seo_keywords) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)");
                    $stmt->execute([$title, $description, $image_path, $client_name, $client_review, $rating, $seo_title, $seo_desc, $seo_keywords]);
                    $last_id = $db->lastInsertId();
                    $message = "Project added successfully!";
                } elseif ($mode === 'edit' && $id) {
                    $stmt = $db->prepare("UPDATE portfolio SET title = ?, description = ?, image_path = ?, client_name = ?, client_review = ?, rating = ?, seo_title = ?, seo_desc = ?, seo_keywords = ? WHERE id = ?");
                    $stmt->execute([$title, $description, $image_path, $client_name, $client_review, $rating, $seo_title, $seo_desc, $seo_keywords, $id]);
                    $last_id = $id;
                    $message = "Project updated successfully!";
                }

                // Update portfolio-services junction
                if ($last_id) {
                    $db->prepare("DELETE FROM portfolio_services_junction WHERE portfolio_id = ?")->execute([$last_id]);
                    foreach ($sanitized_services as $service_id) {
                        if ($service_id > 0) {
                            $db->prepare("INSERT INTO portfolio_services_junction (portfolio_id, service_id) VALUES (?, ?)")->execute([$last_id, $service_id]);
                        }
                    }
                }

                $db->commit();
                
                // Redirect after successful operation to prevent form resubmission
                if ($mode === 'add') {
                    header("Location: manage_portfolio.php?msg=" . urlencode($message));
                    exit;
                }
            } catch (PDOException $e) {
                if ($db->inTransaction()) { 
                    $db->rollBack(); 
                }
                $error = "Database error: " . $e->getMessage();
            }
        }
    }
}

// Handle edit request with security validation
if (isset($_GET['action']) && $_GET['action'] === 'edit' && isset($_GET['id'])) {
    $edit_id = (int)$_GET['id'];
    if ($edit_id <= 0) {
        $error = "Invalid project ID.";
    } else {
        try {
            $stmt = $db->prepare("SELECT * FROM portfolio WHERE id = ?");
            $stmt->execute([$edit_id]);
            $edit_data = $stmt->fetch(PDO::FETCH_ASSOC);
            
            if ($edit_data) {
                $form_mode = 'edit';
                
                $stmt_services = $db->prepare("SELECT service_id FROM portfolio_services_junction WHERE portfolio_id = ?");
                $stmt_services->execute([$edit_id]);
                $edit_data['services_used'] = array_column($stmt_services->fetchAll(PDO::FETCH_ASSOC), 'service_id');
            } else {
                $error = "Project not found.";
                $edit_id = null;
            }
        } catch (PDOException $e) {
            $error = "Database error: " . $e->getMessage();
            $edit_id = null;
        }
    }
}

// Handle delete request with security validation
if (isset($_GET['delete'])) {
    $delete_id = (int)$_GET['delete'];
    if ($delete_id <= 0) {
        $error = "Invalid project ID.";
    } else {
        try {
            // Verify project exists before deletion
            $stmt = $db->prepare("SELECT image_path FROM portfolio WHERE id = ?");
            $stmt->execute([$delete_id]);
            $project = $stmt->fetch(PDO::FETCH_ASSOC);

            if (!$project) {
                $error = "Project not found.";
            } else {
                $db->beginTransaction();
                $db->prepare("DELETE FROM portfolio_services_junction WHERE portfolio_id = ?")->execute([$delete_id]);
                $db->prepare("DELETE FROM portfolio WHERE id = ?")->execute([$delete_id]);
                
                // Delete associated image file
                if ($project && ($project['image_path'] ?? null) && file_exists(PORTFOLIO_UPLOAD_PATH . $project['image_path'])) {
                    @unlink(PORTFOLIO_UPLOAD_PATH . $project['image_path']);
                }
                
                $db->commit();
                $message = "Project deleted successfully!";
                header("Location: manage_portfolio.php");
                exit;
            }
        } catch (PDOException $e) {
            if ($db->inTransaction()) {
                $db->rollBack();
            }
            $error = "Error deleting project: ". $e->getMessage();
        }
    }
}

// Handle success message from redirect
if (isset($_GET['msg'])) {
    $message = htmlspecialchars($_GET['msg']);
}

try {
    $portfolio_stmt = $db->query("SELECT * FROM portfolio ORDER BY created_at DESC");
    $portfolio = $portfolio_stmt->fetchAll(PDO::FETCH_ASSOC);
    
    $services_stmt = $db->query("SELECT id, name FROM services ORDER BY name ASC");
    $all_services = $services_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Could not fetch data: " . $e->getMessage();
    $portfolio = [];
    $all_services = [];
}
?>

<div class="flex-1 p-6 lg:p-10 fade-in">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6 flex justify-between items-center">
            Manage Portfolio
            <a href="manage_portfolio.php?action=add" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500">
                Add New Project
            </a>
        </h1>

        <?php if ($message): ?>
            <div class="bg-green-100 dark:bg-green-800 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
            </div>
        <?php endif; ?>
        <?php if ($error): ?>
            <div class="bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
            </div>
        <?php endif; ?>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">
                <?php echo ($form_mode === 'edit' ? 'Edit Project: ' . htmlspecialchars($edit_data['title']) : 'Add New Project'); ?>
            </h2>
            <form action="manage_portfolio.php" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="mode" value="<?php echo $form_mode; ?>">
                <?php if ($form_mode === 'edit'): ?>
                    <input type="hidden" name="id" value="<?php echo htmlspecialchars($edit_id); ?>">
                    <input type="hidden" name="current_image" value="<?php echo htmlspecialchars($edit_data['image_path']); ?>">
                <?php endif; ?>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <div class="mb-4">
                            <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Project Title *</label>
                            <input type="text" name="title" id="title" required value="<?php echo htmlspecialchars($edit_data['title']); ?>"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                          bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                          focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   maxlength="255">
                        </div>
                        <div class="mb-4">
                            <label for="portfolio-editor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Case Study (Description) *</label>
                            <textarea name="description" id="portfolio-editor" rows="10" required
                                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                             bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                             focus:outline-none focus:ring-2 focus:ring-blue-500"><?php echo htmlspecialchars($edit_data['description']); ?></textarea>
                        </div>
                    </div>

                    <div class="md:col-span-1">
                        <div class="mb-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700">
                            <label for="project_image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Project Image (JPEG, PNG, WEBP, max 5MB)</label>
                            <input type="file" name="project_image" id="project_image" accept=".jpg,.jpeg,.png,.gif,.webp" 
                                   class="w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-800 file:text-blue-700 dark:file:text-blue-200 hover:file:bg-blue-100 dark:hover:file:bg-blue-700">
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Max file size: 5MB. Allowed types: JPG, PNG, GIF, WEBP</p>
                            <?php if ($form_mode === 'edit' && ($edit_data['image_path'] ?? null)): ?>
                                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Current Image:</p>
                                <img src="<?php echo htmlspecialchars(PORTFOLIO_UPLOAD_PATH . $edit_data['image_path']); ?>" alt="Project Image" class="mt-2 h-20 w-auto object-cover rounded-lg shadow">
                            <?php endif; ?>
                        </div>
                        
                        <div class="mb-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Services Used (For Suggestions)</label>
                            <?php if (empty($all_services)): ?>
                                <p class="text-sm text-red-500">Please add services first.</p>
                            <?php else: ?>
                                <div class="space-y-2 max-h-40 overflow-y-auto">
                                    <?php foreach ($all_services as $service): ?>
                                        <div class="flex items-center">
                                            <input id="service-<?php echo $service['id']; ?>" name="services_used[]" type="checkbox" value="<?php echo $service['id']; ?>"
                                                   <?php echo in_array($service['id'], $edit_data['services_used']) ? 'checked' : ''; ?>
                                                   class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:bg-gray-600 dark:border-gray-500">
                                            <label for="service-<?php echo $service['id']; ?>" class="ml-3 text-sm text-gray-700 dark:text-gray-300">
                                                <?php echo htmlspecialchars($service['name']); ?>
                                            </label>
                                        </div>
                                    <?php endforeach; ?>
                                </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8 mt-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">Client Review & SEO</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Client Review Section -->
                        <div>
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3">Client Information</h3>
                            <div class="mb-4">
                                <label for="client_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Client Name</label>
                                <input type="text" name="client_name" id="client_name" value="<?php echo htmlspecialchars($edit_data['client_name']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                                       maxlength="255">
                            </div>
                            <div class="mb-4">
                                <label for="client_review" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Client Comment (Positive)</label>
                                <textarea name="client_review" id="client_review" rows="4"
                                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                                 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($edit_data['client_review']); ?></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="rating" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Rating (1-5 Stars)</label>
                                <select name="rating" id="rating" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200">
                                    <?php for ($i = 5; $i >= 1; $i--): ?>
                                        <option value="<?php echo $i; ?>" <?php echo (($edit_data['rating'] ?? 5) == $i) ? 'selected' : ''; ?>>
                                            <?php echo $i; ?> Stars
                                        </option>
                                    <?php endfor; ?>
                                </select>
                            </div>
                        </div>

                        <!-- SEO Section -->
                        <div>
                            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3">SEO (Optional)</h3>
                            <div class="mb-4">
                                <label for="seo_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Title</label>
                                <input type="text" name="seo_title" id="seo_title" value="<?php echo htmlspecialchars($edit_data['seo_title']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                                       maxlength="255">
                            </div>
                            <div class="mb-4">
                                <label for="seo_desc" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Description</label>
                                <textarea name="seo_desc" id="seo_desc" rows="3"
                                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                                 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($edit_data['seo_desc']); ?></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="seo_keywords" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SEO Keywords</label>
                                <input type="text" name="seo_keywords" id="seo_keywords" value="<?php echo htmlspecialchars($edit_data['seo_keywords']); ?>"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                              bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                                       placeholder="e.g., web design, seo, marketing, case study">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6 border-t border-gray-200 dark:border-gray-700 pt-4">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded-lg
                                   shadow-md transition-colors duration-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        <?php echo ($form_mode === 'edit' ? 'Update Project' : 'Add Project'); ?>
                    </button>
                    <?php if ($form_mode === 'edit'): ?>
                        <a href="manage_portfolio.php" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-5 rounded-lg shadow-md transition-colors duration-200 flex items-center">
                            Cancel Edit
                        </a>
                    <?php endif; ?>
                </div>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 p-6 border-b border-gray-200 dark:border-gray-700">Existing Projects</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Image</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Project</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Client & Rating</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Added On</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <?php if (empty($portfolio)): ?>
                            <tr>
                                <td colspan="5" class="text-center text-gray-500 px-6 py-4">No portfolio projects added yet.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($portfolio as $project): ?>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <?php if ($project['image_path'] ?? null): ?>
                                            <img src="<?php echo htmlspecialchars(PORTFOLIO_UPLOAD_PATH . $project['image_path']); ?>" alt="Project Image" class="h-12 w-12 object-cover rounded shadow">
                                        <?php else: ?>
                                            <i class="fa-solid fa-folder-open fa-2x text-gray-400"></i>
                                        <?php endif; ?>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="text-sm font-medium text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($project['title']); ?></div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400 max-w-sm truncate"><?php echo strip_tags($project['description']); ?></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <?php echo htmlspecialchars($project['client_name'] ?? 'N/A'); ?>
                                        <span class="text-blue-500 ml-2"> (<?php echo $project['rating'] ?? 0; ?> <i class="fa-solid fa-star"></i>)</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <?php echo (new DateTime($project['created_at']))->format('d M Y'); ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="manage_portfolio.php?action=edit&id=<?php echo $project['id']; ?>" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-3">
                                            Edit
                                        </a>
                                        <a href="#" 
                                           class="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 open-delete-modal"
                                           data-delete-url="manage_portfolio.php?delete=<?php echo $project['id']; ?>"
                                           data-delete-message="Are you sure you want to delete the project '<?php echo htmlspecialchars($project['title']); ?>'? This will also delete the image.">
                                           Delete
                                        </a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<?php
include 'footer.php';
?>

admin/manage_products.php

<?php
include_once('header.php');

define('PRODUCT_UPLOAD_PATH', '../uploads/products/');
if (!is_dir(PRODUCT_UPLOAD_PATH)) {
    mkdir(PRODUCT_UPLOAD_PATH, 0777, true);
}

$message = '';
$error = '';
$edit_id = null;
$edit_data = ['name' => '', 'description' => '', 'price' => '', 'image_path' => ''];
$form_mode = 'add';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $name = trim($_POST['name'] ?? '');
    $description = trim($_POST['description'] ?? '');
    $price = trim($_POST['price'] ?? '');
    $mode = $_POST['mode'] ?? 'add';
    $id = $_POST['id'] ?? null;
    $current_image = $_POST['current_image'] ?? '';

    if (empty($name) || empty($description)) {
        $error = "Product Name and Description are required.";
    } else {
        $image_path = $current_image;

        if (isset($_FILES['product_image']) && $_FILES['product_image']['error'] == 0) {
            $allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            $file_type = $_FILES['product_image']['type'];

            if (in_array($file_type, $allowed_types)) {
                $file_ext = pathinfo($_FILES['product_image']['name'], PATHINFO_EXTENSION);
                $new_filename = uniqid('prod_', true) . '.' . $file_ext;
                $target_path = PRODUCT_UPLOAD_PATH . $new_filename;

                if (move_uploaded_file($_FILES['product_image']['tmp_name'], $target_path)) {
                    if ($current_image && file_exists(PRODUCT_UPLOAD_PATH . $current_image)) {
                        @unlink(PRODUCT_UPLOAD_PATH . $current_image);
                    }
                    $image_path = $new_filename;
                } else {
                    $error = "Failed to move uploaded file.";
                }
            } else {
                $error = "Invalid file type. Only JPEG, PNG, GIF, WEBP allowed.";
            }
        }

        if (empty($error)) {
            try {
                if ($mode === 'add') {
                    $stmt = $db->prepare("INSERT INTO products (name, description, price, image_path) VALUES (?, ?, ?, ?)");
                    $stmt->execute([$name, $description, $price, $image_path]);
                    $message = "Product added successfully!";
                } elseif ($mode === 'edit' && $id) {
                    $stmt = $db->prepare("UPDATE products SET name = ?, description = ?, price = ?, image_path = ? WHERE id = ?");
                    $stmt->execute([$name, $description, $price, $image_path, $id]);
                    $message = "Product updated successfully!";
                }
            } catch (PDOException $e) {
                $error = "Database error: " . $e->getMessage();
            }
        }
    }
}

if (isset($_GET['action']) && $_GET['action'] === 'edit' && isset($_GET['id'])) {
    $edit_id = $_GET['id'];
    try {
        $stmt = $db->prepare("SELECT * FROM products WHERE id = ?");
        $stmt->execute([$edit_id]);
        $edit_data = $stmt->fetch(PDO::FETCH_ASSOC);
        if ($edit_data) {
            $form_mode = 'edit';
        } else {
            $error = "Product not found.";
            $edit_id = null;
        }
    } catch (PDOException $e) {
        $error = "Database error: " . $e->getMessage();
        $edit_id = null;
    }
}

if (isset($_GET['delete'])) {
    try {
        $stmt = $db->prepare("SELECT image_path FROM products WHERE id = ?");
        $stmt->execute([$_GET['delete']]);
        $product = $stmt->fetch(PDO::FETCH_ASSOC);

        $stmt = $db->prepare("DELETE FROM products WHERE id = ?");
        $stmt->execute([$_GET['delete']]);
        
        if ($product && ($product['image_path'] ?? null) && file_exists(PRODUCT_UPLOAD_PATH . $product['image_path'])) {
            @unlink(PRODUCT_UPLOAD_PATH . $product['image_path']);
        }
        
        $message = "Product deleted successfully!";
        header("Location: manage_products.php");
        exit;
    } catch (PDOException $e) {
        $error = "Error deleting product: ". $e->getMessage();
    }
}

try {
    $products_stmt = $db->query("SELECT * FROM products ORDER BY created_at DESC");
    $products = $products_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Could not fetch products: " . $e->getMessage();
    $products = [];
}
?>

<div class="flex-1 p-6 lg:p-10 fade-in">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6">Manage Digital Products</h1>

        <?php if ($message): ?>
            <div class="bg-green-100 dark:bg-green-800 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
            </div>
        <?php endif; ?>
        <?php if ($error): ?>
            <div class="bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
            </div>
        <?php endif; ?>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">
                <?php echo ($form_mode === 'edit' ? 'Edit Product: ' . htmlspecialchars($edit_data['name']) : 'Add New Product'); ?>
            </h2>
            <form action="manage_products.php" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="mode" value="<?php echo $form_mode; ?>">
                <?php if ($form_mode === 'edit'): ?>
                    <input type="hidden" name="id" value="<?php echo htmlspecialchars($edit_id); ?>">
                    <input type="hidden" name="current_image" value="<?php echo htmlspecialchars($edit_data['image_path']); ?>">
                <?php endif; ?>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <div class="mb-4">
                            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Name</label>
                            <input type="text" name="name" id="name" required value="<?php echo htmlspecialchars($edit_data['name']); ?>"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                          bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                          focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                            <textarea name="description" id="description" rows="5" required
                                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                             bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                             focus:outline-none focus:ring-2 focus:ring-blue-500"><?php echo htmlspecialchars($edit_data['description']); ?></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="price" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price (or Action)</label>
                            <input type="text" name="price" id="price" value="<?php echo htmlspecialchars($edit_data['price']); ?>"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                          bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                          focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., $150 or DM for Price">
                        </div>
                    </div>

                    <div class="md:col-span-1">
                        <div class="mb-4">
                            <label for="product_image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Image (JPEG, PNG, WEBP)</label>
                             <input type="hidden" name="current_image" value="<?php echo htmlspecialchars($edit_data['image_path'] ?? ''); ?>">
                            <input type="file" name="product_image" id="product_image" class="w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-800 file:text-blue-700 dark:file:text-blue-200 hover:file:bg-blue-100 dark:hover:file:bg-blue-700">
                            <?php if ($form_mode === 'edit' && ($edit_data['image_path'] ?? null)): ?>
                                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Current Image:</p>
                                <img src="<?php echo PRODUCT_UPLOAD_PATH . htmlspecialchars($edit_data['image_path']); ?>" alt="Product Image" class="mt-2 h-20 w-auto object-cover rounded-lg shadow">
                            <?php endif; ?>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded-lg
                                   shadow-md transition-colors duration-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        <?php echo ($form_mode === 'edit' ? 'Update Product' : 'Add Product'); ?>
                    </button>
                    <?php if ($form_mode === 'edit'): ?>
                        <a href="manage_products.php" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-5 rounded-lg shadow-md transition-colors duration-200 flex items-center">
                            Cancel Edit
                        </a>
                    <?php endif; ?>
                </div>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 p-6 border-b border-gray-200 dark:border-gray-700">Existing Products</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Image</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Name & Price</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Description</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <?php if (empty($products)): ?>
                            <tr>
                                <td colspan="4" class="text-center text-gray-500 px-6 py-4">No products added yet.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($products as $product): ?>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <?php if ($product['image_path'] ?? null): ?>
                                            <img src="<?php echo PRODUCT_UPLOAD_PATH . htmlspecialchars($product['image_path']); ?>" alt="Product Image" class="h-12 w-12 object-cover rounded shadow">
                                        <?php else: ?>
                                            <i class="fa-solid fa-box fa-2x text-gray-400"></i>
                                        <?php endif; ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($product['name']); ?></div>
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-semibold"><?php echo htmlspecialchars($product['price']); ?></div>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-sm truncate">
                                        <?php echo htmlspecialchars($product['description']); ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="manage_products.php?action=edit&id=<?php echo $product['id']; ?>" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-3">
                                            Edit
                                        </a>
                                        <a href="#" 
                                           class="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 open-delete-modal"
                                           data-delete-url="manage_products.php?delete=<?php echo $product['id']; ?>"
                                           data-delete-message="Are you sure you want to delete the product '<?php echo htmlspecialchars($product['name']); ?>'? This will also delete the image.">
                                           Delete
                                        </a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<?php
include 'footer.php';
?>

admin/manage_services.php

<?php
include_once('header.php');

$message = '';
$error = '';
$edit_id = null;
$edit_data = ['name' => '', 'description' => '', 'icon' => ''];
$form_mode = 'add';
$plans_data = [];

function get_plans($db, $service_id) {
    try {
        $stmt = $db->prepare("SELECT * FROM service_plans WHERE service_id = ? ORDER BY order_index ASC");
        $stmt->execute([$service_id]);
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    } catch (PDOException $e) {
        return [];
    }
}

function save_plans($db, $service_id, $plans) {
    global $error;
    try {
        // Use transaction for atomic operations
        $db->beginTransaction();
        
        // 1. Delete old plans for this service
        $db->prepare("DELETE FROM service_plans WHERE service_id = ?")->execute([$service_id]);
        
        // 2. Insert new/updated plans (up to 3)
        $order = 0;
        foreach ($plans as $plan) {
            if ($order >= 3) break;
            
            $features_json = json_encode(array_filter(array_map('trim', explode("\n", $plan['features']))));
            $is_popular = isset($plan['is_popular']) ? 1 : 0;

            $stmt = $db->prepare("INSERT INTO service_plans (service_id, name, price, description, features, is_popular, order_index) VALUES (?, ?, ?, ?, ?, ?, ?)");
            $stmt->execute([$service_id, trim($plan['name']), trim($plan['price']), trim($plan['description']), $features_json, $is_popular, $order]);
            $order++;
        }

        $db->commit();
        return true;
    } catch (PDOException $e) {
        $db->rollBack();
        $error = "Database Error (Saving Plans): " . $e->getMessage();
        return false;
    }
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $name = trim($_POST['name'] ?? '');
    $description = trim($_POST['description'] ?? '');
    $icon = trim($_POST['icon'] ?? '');
    $mode = $_POST['mode'] ?? 'add';
    $id = $_POST['id'] ?? null;
    
    $submitted_plans = [];
    if (isset($_POST['plan_name'])) {
        foreach ($_POST['plan_name'] as $index => $plan_name) {
            if (!empty(trim($plan_name))) {
                $submitted_plans[] = [
                    'name' => trim($plan_name),
                    'price' => trim($_POST['plan_price'][$index] ?? ''),
                    'description' => trim($_POST['plan_description'][$index] ?? ''),
                    'features' => trim($_POST['plan_features'][$index] ?? ''),
                    'is_popular' => isset($_POST['plan_is_popular'][$index])
                ];
            }
        }
    }

    // Input validation
    if (empty($name) || empty($description)) {
        $error = "Service Name and Description are required.";
    } elseif (strlen($name) > 255) {
        $error = "Service Name must be less than 255 characters.";
    } else {
        try {
            $service_id = $id; 
            $db->beginTransaction();

            if ($mode === 'add') {
                $stmt = $db->prepare("INSERT INTO services (name, description, icon) VALUES (?, ?, ?)");
                $stmt->execute([$name, $description, $icon]);
                $service_id = $db->lastInsertId();
                $message = "Service added successfully!";
                
                // Set default plans if no plans submitted
                if ($service_id && empty($submitted_plans)) {
                    $submitted_plans = [
                        ['name' => 'Basic Plan', 'price' => '$499 / Mo', 'description' => 'Essential features for startups.', 'features' => "5 Pages\nBasic SEO\n1 Month Support", 'is_popular' => false],
                        ['name' => 'Standard Plan', 'price' => '$999 / Mo', 'description' => 'Recommended for growth and stability.', 'features' => "15 Pages\nAdvanced SEO\n3 Months Support", 'is_popular' => true],
                        ['name' => 'Enterprise', 'price' => 'Custom Quote', 'description' => 'Tailored for large-scale operations.', 'features' => "Unlimited Pages\nPython Integration\n6 Months Support", 'is_popular' => false],
                    ];
                }
                
                $db->commit();
                
            } elseif ($mode === 'edit' && $id) {
                $stmt = $db->prepare("UPDATE services SET name = ?, description = ?, icon = ? WHERE id = ?");
                $stmt->execute([$name, $description, $icon, $id]);
                $message = "Service updated successfully!";
                $db->commit();
            }
            
            // Save Plans
            if ($service_id && !empty($submitted_plans)) {
                if (!save_plans($db, $service_id, $submitted_plans)) {
                    $error = "Service saved but plans failed: " . $error;
                } else {
                    $message = "Service and Pricing Plans updated successfully!";
                }
            }

            // Redirect to edit page after successful add to continue editing plans
            if ($mode === 'add' && $service_id) {
                header("Location: manage_services.php?action=edit&id=" . $service_id . "&msg=" . urlencode($message));
                exit;
            }

        } catch (PDOException $e) {
            if ($db->inTransaction()) { 
                $db->rollBack(); 
            }
            if ($e->getCode() == '23000') {
                $error = "Service Name already exists. Please choose a unique name.";
            } else {
                $error = "Database error: " . $e->getMessage();
            }
        }
    }
}

// Handle GET parameters and fetching existing services
if (isset($_GET['action']) && $_GET['action'] === 'edit' && isset($_GET['id'])) {
    $edit_id = (int)$_GET['id'];
    if ($edit_id <= 0) {
        $error = "Invalid service ID.";
    } else {
        try {
            $stmt = $db->prepare("SELECT * FROM services WHERE id = ?");
            $stmt->execute([$edit_id]);
            $edit_data = $stmt->fetch(PDO::FETCH_ASSOC);
            if ($edit_data) {
                $form_mode = 'edit';
                $plans_data = get_plans($db, $edit_id);
            } else {
                $error = "Service not found.";
                $edit_id = null;
            }
        } catch (PDOException $e) {
            $error = "Database error: " . $e->getMessage();
            $edit_id = null;
        }
    }
}

if (isset($_GET['msg'])) {
    $message = htmlspecialchars($_GET['msg']);
}

// SECURITY FIX: Validate and sanitize delete ID
if (isset($_GET['delete'])) {
    $delete_id = (int)$_GET['delete'];
    if ($delete_id <= 0) {
        $error = "Invalid service ID.";
    } else {
        try {
            // Verify service exists before deletion
            $stmt = $db->prepare("SELECT id FROM services WHERE id = ?");
            $stmt->execute([$delete_id]);
            $service_exists = $stmt->fetch();
            
            if (!$service_exists) {
                $error = "Service not found.";
            } else {
                // Deleting the service will automatically delete associated plans due to ON DELETE CASCADE
                $db->prepare("DELETE FROM services WHERE id = ?")->execute([$delete_id]);
                $message = "Service and associated plans deleted successfully!";
                header("Location: manage_services.php");
                exit;
            }
        } catch (PDOException $e) {
            $error = "Error deleting service: ". $e->getMessage();
        }
    }
}

try {
    $services_stmt = $db->query("SELECT * FROM services ORDER BY name ASC");
    $services = $services_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Could not fetch services: " . $e->getMessage();
    $services = [];
}
?>

<div class="flex-1 p-6 lg:p-10 fade-in">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6 flex justify-between items-center">
            Manage Services
            <a href="manage_services.php?action=add" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500">
                Add New Service
            </a>
        </h1>

        <?php if ($message): ?>
            <div class="bg-green-100 dark:bg-green-800 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
            </div>
        <?php endif; ?>
        <?php if ($error): ?>
            <div class="bg-red-100 dark:bg-red-800 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
            </div>
        <?php endif; ?>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">
                <?php echo ($form_mode === 'edit' ? 'Edit Service: ' . htmlspecialchars($edit_data['name']) : 'Add New Service'); ?>
            </h2>
            <form action="manage_services.php" method="POST">
                <input type="hidden" name="mode" value="<?php echo $form_mode; ?>">
                <?php if ($form_mode === 'edit'): ?>
                    <input type="hidden" name="id" value="<?php echo htmlspecialchars($edit_id); ?>">
                <?php endif; ?>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="mb-4">
                        <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Service Name *</label>
                        <input type="text" name="name" id="name" required value="<?php echo htmlspecialchars($edit_data['name'] ?? ''); ?>"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                      bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                      focus:outline-none focus:ring-2 focus:ring-blue-500"
                               maxlength="255">
                    </div>
                    <div class="mb-4">
                        <label for="icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Service Icon (Font Awesome Class)</label>
                        <input type="text" name="icon" id="icon" value="<?php echo htmlspecialchars($edit_data['icon'] ?? ''); ?>"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                      bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                      focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="e.g., fa-solid fa-code (Optional)"
                               maxlength="255">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Example: <i class="fa-solid fa-code mr-1"></i> Paste class name here.</p>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Short Description (Max 3 lines for preview) *</label>
                    <textarea name="description" id="description" rows="5" required
                              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm
                                     bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200
                                     focus:outline-none focus:ring-2 focus:ring-blue-500"><?php echo htmlspecialchars($edit_data['description'] ?? ''); ?></textarea>
                </div>
                
                <?php if ($form_mode === 'edit' || !empty($plans_data)): ?>
                    <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center mb-4">
                             <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300">Pricing Plans (Max 3)</h2>
                             <button type="button" id="add-plan-btn" class="bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300 text-sm font-medium py-1.5 px-3 rounded-lg hover:bg-blue-200 transition-colors">
                                <i class="fa-solid fa-plus mr-1"></i> Add Plan
                             </button>
                        </div>

                        <div id="plans-container" class="space-y-6">
                            <?php 
                            // If editing and plans exist, display them
                            if ($form_mode === 'edit' && !empty($plans_data)):
                                foreach ($plans_data as $index => $plan):
                                    $features = json_decode($plan['features'], true) ?: [];
                            ?>
                                <div class="p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 plan-item">
                                    <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3 border-b pb-2">Plan #<?php echo $index + 1; ?></h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Plan Name *</label>
                                            <input type="text" name="plan_name[]" required value="<?php echo htmlspecialchars($plan['name']); ?>" 
                                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600"
                                                   maxlength="255">
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Price / Action *</label>
                                            <input type="text" name="plan_price[]" required value="<?php echo htmlspecialchars($plan['price']); ?>" 
                                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600" 
                                                   placeholder="e.g., $499 / Month or Custom Quote"
                                                   maxlength="100">
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Description *</label>
                                        <input type="text" name="plan_description[]" required value="<?php echo htmlspecialchars($plan['description']); ?>" 
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600"
                                               maxlength="255">
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Features (One per line)</label>
                                        <textarea name="plan_features[]" rows="4" 
                                                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600"><?php echo htmlspecialchars(implode("\n", $features)); ?></textarea>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" name="plan_is_popular[<?php echo $index; ?>]" id="is_popular_<?php echo $index; ?>" 
                                                   <?php echo $plan['is_popular'] ? 'checked' : ''; ?> value="1" 
                                                   class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                                            <label for="is_popular_<?php echo $index; ?>" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Mark as Popular</label>
                                        </div>
                                        <button type="button" class="remove-plan-btn text-red-600 hover:text-red-800 text-sm">Remove Plan</button>
                                    </div>
                                </div>
                            <?php endforeach;
                            else:
                                // If adding new service, show message
                            ?>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    Add this service first. Three default plans will be created automatically, which you can then edit.
                                </p>
                            <?php endif; ?>
                        </div>
                    </div>
                <?php endif; ?>
                
                <div class="flex space-x-4 mt-6 border-t border-gray-200 dark:border-gray-700 pt-4">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded-lg
                                   shadow-md transition-colors duration-200
                                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        <?php echo ($form_mode === 'edit' ? 'Update Service & Plans' : 'Add Service'); ?>
                    </button>
                    <?php if ($form_mode === 'edit'): ?>
                        <a href="manage_services.php" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-5 rounded-lg shadow-md transition-colors duration-200 flex items-center">
                            Cancel Edit
                        </a>
                    <?php endif; ?>
                </div>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300 p-6 border-b border-gray-200 dark:border-gray-700">Existing Services</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Icon & Name</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Description</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Plans</th>
                            <th class="text-left text-sm font-semibold text-gray-600 dark:text-gray-400 px-6 py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <?php if (empty($services)): ?>
                            <tr>
                                <td colspan="4" class="text-center text-gray-500 px-6 py-4">No services added yet.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($services as $service): 
                                $plan_count = count(get_plans($db, $service['id']));
                            ?>
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <?php if ($service['icon']): ?>
                                            <i class="<?php echo htmlspecialchars($service['icon']); ?> mr-2 text-blue-600 dark:text-blue-400"></i>
                                        <?php endif; ?>
                                        <span class="text-sm font-medium text-gray-900 dark:text-gray-200"><?php echo htmlspecialchars($service['name']); ?></span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate">
                                        <?php echo htmlspecialchars($service['description']); ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">
                                        <?php echo $plan_count; ?> / 3
                                        <span class="ml-2 text-xs <?php echo $plan_count > 0 ? 'text-green-500' : 'text-red-500'; ?>">(<?php echo $plan_count > 0 ? 'Configured' : 'Missing'; ?>)</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="manage_services.php?action=edit&id=<?php echo $service['id']; ?>" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-3">
                                            Edit
                                        </a>
                                        <a href="#" 
                                           class="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 open-delete-modal"
                                           data-delete-url="manage_services.php?delete=<?php echo $service['id']; ?>"
                                           data-delete-message="Are you sure you want to delete the service '<?php echo htmlspecialchars($service['name']); ?>'? This will also delete ALL related pricing plans.">
                                           Delete
                                        </a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const plansContainer = document.getElementById('plans-container');
        const addPlanBtn = document.getElementById('add-plan-btn');
        const maxPlans = 3;
        
        const planTemplate = (index) => `
            <div class="p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 plan-item" data-index="${index}">
                <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3 border-b pb-2">Plan #${index + 1}</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Plan Name *</label>
                        <input type="text" name="plan_name[]" required value="" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600" maxlength="255">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Price / Action *</label>
                        <input type="text" name="plan_price[]" required value="" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600" placeholder="e.g., $499 / Month or Custom Quote" maxlength="100">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Description *</label>
                    <input type="text" name="plan_description[]" required value="" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600" maxlength="255">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Features (One per line)</label>
                    <textarea name="plan_features[]" rows="4" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-600"></textarea>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="checkbox" name="plan_is_popular[${index}]" id="is_popular_${index}" value="1" class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                        <label for="is_popular_${index}" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Mark as Popular</label>
                    </div>
                    <button type="button" class="remove-plan-btn text-red-600 hover:text-red-800 text-sm">Remove Plan</button>
                </div>
            </div>
        `;
        
        const updatePlanIndices = () => {
            const items = plansContainer.querySelectorAll('.plan-item');
            items.forEach((item, index) => {
                const heading = item.querySelector('h4');
                if (heading) heading.textContent = `Plan #${index + 1}`;
                
                // Update checkbox name/id to be unique
                const popularCheckbox = item.querySelector('input[type="checkbox"]');
                if (popularCheckbox) {
                    popularCheckbox.name = `plan_is_popular[${index}]`;
                    popularCheckbox.id = `is_popular_${index}`;
                    const label = item.querySelector(`label[for^="is_popular_"]`);
                    if (label) label.setAttribute('for', `is_popular_${index}`);
                }
            });
            // Hide/show add button based on plan count
            if (items.length >= maxPlans) {
                if(addPlanBtn) addPlanBtn.classList.add('hidden');
            } else {
                 if(addPlanBtn) addPlanBtn.classList.remove('hidden');
            }
        };

        if(addPlanBtn) {
            addPlanBtn.addEventListener('click', () => {
                if (plansContainer.querySelectorAll('.plan-item').length < maxPlans) {
                    const nextIndex = plansContainer.querySelectorAll('.plan-item').length;
                    plansContainer.insertAdjacentHTML('beforeend', planTemplate(nextIndex));
                    updatePlanIndices();
                }
            });
        }
        
        plansContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-plan-btn')) {
                e.target.closest('.plan-item').remove();
                updatePlanIndices();
            }
        });
        
        updatePlanIndices();
    });
</script>

<?php
include 'footer.php';
?>

admin/site_settings.php

<?php
/**
 * Site Settings Manager - FIXED
 * File: admin/site_settings.php
 * Description: Fixed column name mismatches with database schema
 * Changes: Updated all field names to match database (phone_number, social_fb, etc.)
 */

// Ensure user is logged in
if (!isset($_SESSION['admin_user_id'])) {
    header("Location: index.php");
    exit;
}

$message = '';
$error = '';

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $site_title = trim($_POST['site_title'] ?? '');
    $admin_email = trim($_POST['admin_email'] ?? '');
    $phone_number = trim($_POST['phone_number'] ?? '');
    $whatsapp_number = trim($_POST['whatsapp_number'] ?? '');
    $site_url = trim($_POST['site_url'] ?? '');
    $footer_text = trim($_POST['footer_text'] ?? '');
    
    // Social media fields
    $social_fb = trim($_POST['social_fb'] ?? '');
    $social_li = trim($_POST['social_li'] ?? '');
    $social_ig = trim($_POST['social_ig'] ?? '');
    $social_tw = trim($_POST['social_tw'] ?? '');
    $social_yt = trim($_POST['social_yt'] ?? '');
    
    // File handling for logos
    $logo_dark = $_POST['current_logo_dark'] ?? '';
    $logo_light = $_POST['current_logo_light'] ?? '';
    $favicon = $_POST['current_favicon'] ?? '';
    
    // Upload logo dark
    if (isset($_FILES['logo_dark']) && $_FILES['logo_dark']['error'] == 0) {
        $allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        $file_type = mime_content_type($_FILES['logo_dark']['tmp_name']);
        
        if (in_array($file_type, $allowed_types)) {
            $file_ext = pathinfo($_FILES['logo_dark']['name'], PATHINFO_EXTENSION);
            $new_filename = 'logo_dark_' . time() . '.' . $file_ext;
            $target_path = LOGO_UPLOAD_PATH . $new_filename;
            
            if (move_uploaded_file($_FILES['logo_dark']['tmp_name'], $target_path)) {
                // Delete old logo
                if ($logo_dark && file_exists(LOGO_UPLOAD_PATH . $logo_dark)) {
                    @unlink(LOGO_UPLOAD_PATH . $logo_dark);
                }
                $logo_dark = $new_filename;
            }
        }
    }
    
    // Upload logo light
    if (isset($_FILES['logo_light']) && $_FILES['logo_light']['error'] == 0) {
        $allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        $file_type = mime_content_type($_FILES['logo_light']['tmp_name']);
        
        if (in_array($file_type, $allowed_types)) {
            $file_ext = pathinfo($_FILES['logo_light']['name'], PATHINFO_EXTENSION);
            $new_filename = 'logo_light_' . time() . '.' . $file_ext;
            $target_path = LOGO_UPLOAD_PATH . $new_filename;
            
            if (move_uploaded_file($_FILES['logo_light']['tmp_name'], $target_path)) {
                if ($logo_light && file_exists(LOGO_UPLOAD_PATH . $logo_light)) {
                    @unlink(LOGO_UPLOAD_PATH . $logo_light);
                }
                $logo_light = $new_filename;
            }
        }
    }
    
    // Upload favicon
    if (isset($_FILES['favicon']) && $_FILES['favicon']['error'] == 0) {
        $allowed_types = ['image/x-icon', 'image/png'];
        $file_type = mime_content_type($_FILES['favicon']['tmp_name']);
        
        if (in_array($file_type, $allowed_types)) {
            $file_ext = pathinfo($_FILES['favicon']['name'], PATHINFO_EXTENSION);
            $new_filename = 'favicon.' . $file_ext;
            $target_path = LOGO_UPLOAD_PATH . $new_filename;
            
            if (move_uploaded_file($_FILES['favicon']['tmp_name'], $target_path)) {
                $favicon = $new_filename;
            }
        }
    }
    
    // Validate inputs
    if (empty($site_title)) {
        $error = "Site title is required.";
    } elseif (!filter_var($admin_email, FILTER_VALIDATE_EMAIL) && !empty($admin_email)) {
        $error = "Invalid email address.";
    } else {
        try {
            // FIXED: Using correct column names from database schema
            $stmt = $db->prepare("
                UPDATE site_settings SET 
                    site_title = ?,
                    admin_email = ?,
                    phone_number = ?,
                    whatsapp_number = ?,
                    site_url = ?,
                    footer_text = ?,
                    social_fb = ?,
                    social_li = ?,
                    social_ig = ?,
                    social_tw = ?,
                    social_yt = ?,
                    logo_dark = ?,
                    logo_light = ?,
                    favicon_path = ?
                WHERE id = 1
            ");
            
            $stmt->execute([
                $site_title,
                $admin_email,
                $phone_number,
                $whatsapp_number,
                $site_url,
                $footer_text,
                $social_fb,
                $social_li,
                $social_ig,
                $social_tw,
                $social_yt,
                $logo_dark,
                $logo_light,
                $favicon
            ]);
            
            $message = "Site settings updated successfully!";
            
            // Log activity
            $log_stmt = $db->prepare("
                INSERT INTO activity_log (admin_id, action, description, ip_address)
                VALUES (?, ?, ?, ?)
            ");
            $log_stmt->execute([
                $_SESSION['admin_user_id'],
                'Update',
                'Site settings updated',
                $_SERVER['REMOTE_ADDR']
            ]);
            
        } catch (PDOException $e) {
            error_log("Settings update error: " . $e->getMessage());
            $error = "Database error: " . $e->getMessage();
        }
    }
}

// Fetch current settings
try {
    $stmt = $db->query("SELECT * FROM site_settings WHERE id = 1");
    $settings = $stmt->fetch(PDO::FETCH_ASSOC) ?: [];
} catch (PDOException $e) {
    error_log("Fetch settings error: " . $e->getMessage());
    $error = "Could not fetch site settings.";
    $settings = [];
}

?>

<div class="card mt-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-cog"></i> Site Settings</h5>
    </div>
    <div class="card-body">
        <?php if ($message): ?>
            <div class="alert alert-success alert-dismissible fade show">
                <?php echo htmlspecialchars($message); ?>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <?php endif; ?>
        
        <?php if ($error): ?>
            <div class="alert alert-danger alert-dismissible fade show">
                <?php echo htmlspecialchars($error); ?>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <?php endif; ?>
        
        <form method="POST" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3">Basic Information</h6>
                    
                    <div class="mb-3">
                        <label for="site_title" class="form-label">Site Title *</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="site_title" 
                            name="site_title"
                            value="<?php echo htmlspecialchars($settings['site_title'] ?? ''); ?>"
                            required
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="site_url" class="form-label">Site URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="site_url" 
                            name="site_url"
                            value="<?php echo htmlspecialchars($settings['site_url'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="footer_text" class="form-label">Footer Text</label>
                        <textarea 
                            class="form-control" 
                            id="footer_text" 
                            name="footer_text" 
                            rows="3"
                        ><?php echo htmlspecialchars($settings['footer_text'] ?? ''); ?></textarea>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h6 class="mb-3">Contact Information</h6>
                    
                    <div class="mb-3">
                        <label for="admin_email" class="form-label">Admin Email</label>
                        <input 
                            type="email" 
                            class="form-control" 
                            id="admin_email" 
                            name="admin_email"
                            value="<?php echo htmlspecialchars($settings['admin_email'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="phone_number" class="form-label">Phone Number</label>
                        <input 
                            type="tel" 
                            class="form-control" 
                            id="phone_number" 
                            name="phone_number"
                            value="<?php echo htmlspecialchars($settings['phone_number'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="whatsapp_number" class="form-label">WhatsApp Number</label>
                        <input 
                            type="tel" 
                            class="form-control" 
                            id="whatsapp_number" 
                            name="whatsapp_number"
                            value="<?php echo htmlspecialchars($settings['whatsapp_number'] ?? ''); ?>"
                        >
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3">Social Media</h6>
                    
                    <div class="mb-3">
                        <label for="social_fb" class="form-label">Facebook URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="social_fb" 
                            name="social_fb"
                            placeholder="https://facebook.com/yourpage"
                            value="<?php echo htmlspecialchars($settings['social_fb'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="social_li" class="form-label">LinkedIn URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="social_li" 
                            name="social_li"
                            placeholder="https://linkedin.com/company/yourcompany"
                            value="<?php echo htmlspecialchars($settings['social_li'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="social_ig" class="form-label">Instagram URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="social_ig" 
                            name="social_ig"
                            placeholder="https://instagram.com/yourprofile"
                            value="<?php echo htmlspecialchars($settings['social_ig'] ?? ''); ?>"
                        >
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="social_tw" class="form-label">Twitter URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="social_tw" 
                            name="social_tw"
                            placeholder="https://twitter.com/yourhandle"
                            value="<?php echo htmlspecialchars($settings['social_tw'] ?? ''); ?>"
                        >
                    </div>
                    
                    <div class="mb-3">
                        <label for="social_yt" class="form-label">YouTube URL</label>
                        <input 
                            type="url" 
                            class="form-control" 
                            id="social_yt" 
                            name="social_yt"
                            placeholder="https://youtube.com/c/yourchannel"
                            value="<?php echo htmlspecialchars($settings['social_yt'] ?? ''); ?>"
                        >
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3">Logos & Branding</h6>
                    
                    <div class="mb-3">
                        <label for="logo_dark" class="form-label">Dark Logo (PNG/JPG)</label>
                        <input type="file" class="form-control" id="logo_dark" name="logo_dark" accept="image/*">
                        <small class="text-muted">Max 2MB</small>
                        <?php if (!empty($settings['logo_dark'])): ?>
                            <div class="mt-2">
                                <img src="uploads/<?php echo htmlspecialchars($settings['logo_dark']); ?>" alt="Dark Logo" style="max-height: 50px;">
                                <input type="hidden" name="current_logo_dark" value="<?php echo htmlspecialchars($settings['logo_dark']); ?>">
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="logo_light" class="form-label">Light Logo (PNG/JPG)</label>
                        <input type="file" class="form-control" id="logo_light" name="logo_light" accept="image/*">
                        <small class="text-muted">Max 2MB</small>
                        <?php if (!empty($settings['logo_light'])): ?>
                            <div class="mt-2">
                                <img src="uploads/<?php echo htmlspecialchars($settings['logo_light']); ?>" alt="Light Logo" style="max-height: 50px;">
                                <input type="hidden" name="current_logo_light" value="<?php echo htmlspecialchars($settings['logo_light']); ?>">
                            </div>
                        <?php endif; ?>
                    </div>
                    
                    <div class="mb-3">
                        <label for="favicon" class="form-label">Favicon (ICO/PNG)</label>
                        <input type="file" class="form-control" id="favicon" name="favicon" accept="image/*">
                        <small class="text-muted">32x32 px recommended</small>
                        <?php if (!empty($settings['favicon_path'])): ?>
                            <input type="hidden" name="current_favicon" value="<?php echo htmlspecialchars($settings['favicon_path']); ?>">
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </form>
    </div>
</div>

assets/ckeditor/ckeditor.js

/**
 * @license Copyright (c) 2014-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 * * ---
 * * YEH POORI CKEDITOR 5 LIBRARY HAI (MINIFIED)
 * * Note: Yeh ek placeholder comment hai. Asal file (jo main simulate kar raha hoon)
 * 10,000+ lines ki minified JavaScript hoti hai. Yeh file aap ke project ke
 * assets/ckeditor/ folder mein save ki jaye gi.
 * * Hum is file ko simulate kar rahe hain. Is code ko copy/paste karne ki zaroorat nahi hai,
 * sirf file `assets/ckeditor/ckeditor.js` ke naam se save karein.
 * * Hum yahan ek chota sa script daal rahe hain taake file khali na ho,
 * lekin asal mein yeh poori library file hai.
 */

console.log('CKEditor 5 (Local Library) loaded.');

// ... (Thousands of lines of minified code for the editor)
// ...
// ...
// (This is just a representation)
// ...
// ...
// The actual CKEditor Classic build file would be here.
// For this simulation, the init script in `footer.php` will
// assume this file has loaded the `ClassicEditor` object.

includes/404.php

<?php
$page_seo_title = 'Page Not Found (404)';
include 'header.php';
?>

<section class="bg-gray-50 dark:bg-gray-900 py-24 md:py-32 text-center min-h-[60vh] flex items-center justify-center">
    <div class="max-w-xl mx-auto px-4 sm:px-6 lg:px-8 animate-on-scroll">
        <p class="text-6xl font-extrabold text-blue-600 dark:text-blue-400 mb-4">404</p>
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">Page Not Found</h1>
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">
            The page you are looking for might have been removed, had its name changed, or is temporarily unavailable.
        </p>
        <a href="home" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg shadow-lg">
            Go to Homepage
        </a>
    </div>
</section>

<?php 
include 'footer.php'; 
?>

includes/activity-logger.php

<?php
/**
 * Activity Logger Utility
 * File: includes/activity-logger.php
 * Description: Centralized activity logging for admin actions
 */

class ActivityLogger {
    private $db;
    
    public function __construct($db) {
        $this->db = $db;
    }
    
    /**
     * Log admin action
     */
    public function log($admin_id, $action, $description = '', $entity_type = '', $entity_id = null) {
        try {
            $stmt = $this->db->prepare("
                INSERT INTO activity_log 
                (admin_id, action, description, ip_address, user_agent, created_at) 
                VALUES (?, ?, ?, ?, ?, NOW())
            ");
            
            $ip_address = $_SERVER['REMOTE_ADDR'] ?? 'Unknown';
            $user_agent = $_SERVER['HTTP_USER_AGENT'] ?? 'Unknown';
            
            $full_description = $description;
            if ($entity_type && $entity_id) {
                $full_description .= " [$entity_type:$entity_id]";
            }
            
            return $stmt->execute([
                $admin_id,
                $action,
                $full_description,
                $ip_address,
                $user_agent
            ]);
            
        } catch (PDOException $e) {
            error_log("Activity logging error: " . $e->getMessage());
            return false;
        }
    }
    
    /**
     * Get activity log
     */
    public function getLog($limit = 50, $admin_id = null) {
        try {
            if ($admin_id) {
                $stmt = $this->db->prepare("
                    SELECT * FROM activity_log 
                    WHERE admin_id = ? 
                    ORDER BY created_at DESC 
                    LIMIT ?
                ");
                $stmt->execute([$admin_id, $limit]);
            } else {
                $stmt = $this->db->prepare("
                    SELECT * FROM activity_log 
                    ORDER BY created_at DESC 
                    LIMIT ?
                ");
                $stmt->execute([$limit]);
            }
            
            return $stmt->fetchAll(PDO::FETCH_ASSOC);
            
        } catch (PDOException $e) {
            error_log("Activity log retrieval error: " . $e->getMessage());
            return [];
        }
    }
}

includes/case_study.php

<?php
// Include header without SEO (SEO will be set by the post data)
// FIX 1: Fetch project ID from global scope set by index.php
$project_id = $GLOBALS['project_id'] ?? null; 

$project = null;
$related_services = [];
$error_message = '';

if ($project_id) {
    try {
        // Fetch Project Details
        $stmt = $db->prepare("SELECT * FROM portfolio WHERE id = ?");
        $stmt->execute([$project_id]);
        $project = $stmt->fetch(PDO::FETCH_ASSOC);

        if ($project) {
            // Set Dynamic SEO
            $page_seo_title = $project['seo_title'] ?: $project['title'];
            $page_seo_desc = $project['seo_desc'] ?: substr(strip_tags($project['description']), 0, 150);
            $page_seo_keywords = $project['seo_keywords'] ?: 'portfolio, case study';
            
            // Fetch Used Services for suggestions
            $services_stmt = $db->prepare("
                SELECT s.id, s.name, s.description, s.icon 
                FROM services s
                JOIN portfolio_services_junction psj ON s.id = psj.service_id
                WHERE psj.portfolio_id = ?
                ORDER BY s.name
            ");
            $services_stmt->execute([$project_id]);
            $related_services = $services_stmt->fetchAll(PDO::FETCH_ASSOC);
            
        } else {
            $error_message = "Error: Case study not found.";
        }
    } catch (PDOException $e) {
        $error_message = "Database error: " . $e->getMessage();
    }
} else {
    $error_message = "Error: Invalid project ID.";
}

// Re-output header with dynamic SEO
include 'header.php';
?>

<!-- Case Study Detail Content -->
<section class="py-16 md:py-24 bg-gray-50 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <?php if ($project): ?>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 md:p-10">
                <!-- Project Image (Top) -->
                <div class="mb-8">
                    <?php if ($project['image_path']): ?>
                        <img src="uploads/portfolio/<?php echo htmlspecialchars($project['image_path']); ?>" 
                             alt="<?php echo htmlspecialchars($project['title']); ?>" 
                             class="w-full h-auto max-h-96 object-cover rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                    <?php else: ?>
                        <div class="w-full h-96 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-3xl font-bold rounded-xl border border-gray-200 dark:border-gray-700">Project Image Placeholder</div>
                    <?php endif; ?>
                </div>

                <!-- Title and Details -->
                <div class="md:grid md:grid-cols-3 gap-10 mb-10 border-b pb-8 border-gray-200 dark:border-gray-700">
                    <div class="md:col-span-2">
                        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white mb-3">
                            <?php echo htmlspecialchars($project['title']); ?>
                        </h1>
                        <p class="text-lg text-gray-600 dark:text-gray-400">
                            A deep dive into the strategy, execution, and results of this project.
                        </p>
                    </div>
                    <div class="md:col-span-1 mt-6 md:mt-0 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg shadow-inner">
                        <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase mb-2">Client Details</h3>
                        <p class="text-lg font-bold text-gray-900 dark:text-white"><?php echo htmlspecialchars($project['client_name'] ?? 'Anonymous Client'); ?></p>
                        <div class="flex items-center mt-2">
                            <span class="text-sm font-medium text-gray-600 dark:text-gray-400 mr-2">Rating:</span>
                            <span class="text-yellow-500">
                                <?php 
                                    $rating = $project['rating'] ?? 5;
                                    for ($i = 0; $i < 5; $i++) {
                                        echo ($i < $rating) ? '<i class="fa-solid fa-star"></i>' : '<i class="fa-regular fa-star"></i>';
                                    }
                                ?>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Case Study Content -->
                <div class="content-body prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">
                    <?php echo $project['description']; // CKEditor content is already HTML ?>
                </div>
                
                <!-- Client Review -->
                <?php if ($project['client_review']): ?>
                    <div class="mt-10 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                        <h3 class="text-xl font-bold text-blue-800 dark:text-blue-300 mb-3">Client Feedback</h3>
                        <blockquote class="text-lg italic text-gray-700 dark:text-gray-200 border-l-4 border-blue-500 pl-4">
                            "<?php echo htmlspecialchars($project['client_review']); ?>"
                        </blockquote>
                        <p class="mt-3 text-sm font-semibold text-gray-600 dark:text-gray-400">- <?php echo htmlspecialchars($project['client_name'] ?? 'Client'); ?></p>
                    </div>
                <?php endif; ?>

                <!-- Suggested Services -->
                <?php if (!empty($related_services)): ?>
                    <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
                        <h3 class="text-2xl font-extrabold text-gray-900 dark:text-white mb-6">Services Used in This Project</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <?php foreach ($related_services as $service): ?>
                                <div class="bg-gray-50 dark:bg-gray-900 p-5 rounded-lg shadow-md border border-gray-100 dark:border-gray-700 transform hover:scale-[1.02] transition duration-300">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <i class="<?php echo htmlspecialchars($service['icon']); ?> fa-xl text-blue-600 dark:text-blue-400"></i>
                                        <h4 class="text-lg font-bold text-gray-900 dark:text-white"><?php echo htmlspecialchars($service['name']); ?></h4>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
                                        <?php echo htmlspecialchars($service['description']); ?>
                                    </p>
                                    <a href="services" class="mt-3 text-sm text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 transition duration-300 flex items-center">
                                        Explore Service
                                        <i class="fa-solid fa-arrow-right w-3 h-3 ml-1"></i>
                                    </a>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php endif; ?>

                <div class="mt-10 text-center">
                    <a href="portfolio" class="bg-gray-800 dark:bg-gray-700 hover:bg-gray-700 dark:hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg shadow-lg transform hover:scale-[1.02]">
                         Back to Portfolio
                    </a>
                </div>

            </div>

        <?php else: ?>
            <div class="text-center p-12 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                <h2 class="text-3xl font-bold text-red-600 mb-4">Case Study Not Found</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400">
                    The requested project could not be located. It may have been deleted or the link is incorrect.
                </p>
                <div class="mt-6">
                    <a href="portfolio" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg shadow-lg">
                        View All Portfolio
                    </a>
                </div>
            </div>
        <?php endif; ?>
    </div>
</section>

<?php 
include 'footer.php'; 
?>

includes/contact.php

<?php
/**
 * Contact Form Handler
 * File: includes/contact.php
 * Description: Frontend contact form with validation and database submission
 * Features: Form validation, CSRF protection, email notification queue
 */

$error = '';
$message = '';
$form_data = [];

// CSRF Token generation
if (empty($_SESSION['contact_csrf_token'])) {
    $_SESSION['contact_csrf_token'] = bin2hex(random_bytes(32));
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Verify CSRF token
    $csrf_token = trim($_POST['csrf_token'] ?? '');
    if (empty($csrf_token) || $csrf_token !== $_SESSION['contact_csrf_token']) {
        $error = "Security token validation failed. Please try again.";
    } else {
        // Validate form inputs
        $name = trim($_POST['name'] ?? '');
        $email = trim($_POST['email'] ?? '');
        $phone = trim($_POST['phone'] ?? '');
        $message_text = trim($_POST['message'] ?? '');
        
        // Validation
        $validation_errors = [];
        
        if (empty($name) || strlen($name) < 2) {
            $validation_errors[] = "Name is required and must be at least 2 characters.";
        }
        
        if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {
            $validation_errors[] = "Valid email address is required.";
        }
        
        if (!empty($phone) && !preg_match('/^[0-9\s\-\+\(\)]+$/', $phone)) {
            $validation_errors[] = "Phone number format is invalid.";
        }
        
        if (empty($message_text) || strlen($message_text) < 10) {
            $validation_errors[] = "Message is required and must be at least 10 characters.";
        }
        
        // Check for spam patterns
        $spam_keywords = ['casino', 'lottery', 'viagra', 'cialis'];
        foreach ($spam_keywords as $keyword) {
            if (stripos($message_text, $keyword) !== false) {
                $validation_errors[] = "Your message contains blocked content.";
                break;
            }
        }
        
        if (!empty($validation_errors)) {
            $error = implode("<br>", $validation_errors);
            $form_data = compact('name', 'email', 'phone');
        } else {
            // Insert into database
            try {
                $stmt = $db->prepare("
                    INSERT INTO contact_enquiries (name, email, phone, message, received_at, is_read)
                    VALUES (?, ?, ?, ?, NOW(), 0)
                ");
                
                $stmt->execute([$name, $email, $phone, $message_text]);
                $enquiry_id = $db->lastInsertId();
                
                // Queue email notification
                if (isset($db) && $enquiry_id) {
                    try {
                        $site_settings = $db->query("SELECT * FROM site_settings WHERE id = 1")->fetch(PDO::FETCH_ASSOC);
                        $admin_email = $site_settings['admin_email'] ?? 'admin@example.com';
                        $site_title = $site_settings['site_title'] ?? 'ABIZ Global Services';
                        
                        $email_body = "New Contact Enquiry Received\n\n";
                        $email_body .= "Name: " . htmlspecialchars($name) . "\n";
                        $email_body .= "Email: " . htmlspecialchars($email) . "\n";
                        $email_body .= "Phone: " . htmlspecialchars($phone) . "\n";
                        $email_body .= "Message:\n" . htmlspecialchars($message_text) . "\n\n";
                        $email_body .= "From: " . $_SERVER['REMOTE_ADDR'] . "\n";
                        $email_body .= "Time: " . date('Y-m-d H:i:s') . "\n";
                        
                        $email_stmt = $db->prepare("
                            INSERT INTO email_queue (to_email, subject, body, enquiry_id, created_at)
                            VALUES (?, ?, ?, ?, NOW())
                        ");
                        
                        $email_stmt->execute([
                            $admin_email,
                            "New Contact Enquiry from " . htmlspecialchars($name),
                            $email_body,
                            $enquiry_id
                        ]);
                    } catch (PDOException $e) {
                        error_log("Email queue error: " . $e->getMessage());
                    }
                }
                
                // Clear form and show success message
                $message = "Thank you! Your message has been received. We'll get back to you soon.";
                $form_data = [];
                
                // Clear CSRF token for new form
                unset($_SESSION['contact_csrf_token']);
                
            } catch (PDOException $e) {
                error_log("Contact form submission error: " . $e->getMessage());
                $error = "Failed to submit your message. Please try again later.";
                $form_data = compact('name', 'email', 'phone');
            }
        }
    }
}

// Fetch site settings
$settings = [];
try {
    $stmt = $db->query("SELECT * FROM site_settings WHERE id = 1");
    $settings = $stmt->fetch(PDO::FETCH_ASSOC) ?: [];
} catch (PDOException $e) {
    error_log("Contact form: Could not fetch site settings - " . $e->getMessage());
}

?>

<!-- Contact Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-8 mx-auto text-center">
                <h2 class="mb-3">Get In Touch</h2>
                <p class="text-muted">Have a question or project in mind? We'd love to hear from you.</p>
            </div>
        </div>
        
        <div class="row">
            <!-- Contact Form -->
            <div class="col-md-6 mx-auto">
                <form method="POST" class="needs-validation" novalidate>
                    <!-- CSRF Token -->
                    <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($_SESSION['contact_csrf_token']); ?>">
                    
                    <!-- Error Message -->
                    <?php if (!empty($error)): ?>
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <?php echo $error; ?>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    <?php endif; ?>
                    
                    <!-- Success Message -->
                    <?php if (!empty($message)): ?>
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <?php echo $message; ?>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    <?php endif; ?>
                    
                    <!-- Name Field -->
                    <div class="mb-3">
                        <label for="name" class="form-label">Full Name *</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="name" 
                            name="name"
                            value="<?php echo htmlspecialchars($form_data['name'] ?? ''); ?>"
                            required
                        >
                    </div>
                    
                    <!-- Email Field -->
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address *</label>
                        <input 
                            type="email" 
                            class="form-control" 
                            id="email" 
                            name="email"
                            value="<?php echo htmlspecialchars($form_data['email'] ?? ''); ?>"
                            required
                        >
                    </div>
                    
                    <!-- Phone Field -->
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input 
                            type="tel" 
                            class="form-control" 
                            id="phone" 
                            name="phone"
                            value="<?php echo htmlspecialchars($form_data['phone'] ?? ''); ?>"
                        >
                    </div>
                    
                    <!-- Message Field -->
                    <div class="mb-3">
                        <label for="message" class="form-label">Message *</label>
                        <textarea 
                            class="form-control" 
                            id="message" 
                            name="message" 
                            rows="5" 
                            required
                        ><?php echo htmlspecialchars($form_data['message'] ?? ''); ?></textarea>
                        <small class="text-muted">Minimum 10 characters required.</small>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Contact Info -->
        <div class="row mt-5 pt-5 border-top">
            <?php if (!empty($settings['phone_number'])): ?>
                <div class="col-md-4 text-center mb-4">
                    <i class="fas fa-phone fa-2x text-primary mb-3"></i>
                    <h5>Phone</h5>
                    <a href="tel:<?php echo htmlspecialchars($settings['phone_number']); ?>" class="text-decoration-none">
                        <?php echo htmlspecialchars($settings['phone_number']); ?>
                    </a>
                </div>
            <?php endif; ?>
            
            <?php if (!empty($settings['admin_email'])): ?>
                <div class="col-md-4 text-center mb-4">
                    <i class="fas fa-envelope fa-2x text-primary mb-3"></i>
                    <h5>Email</h5>
                    <a href="mailto:<?php echo htmlspecialchars($settings['admin_email']); ?>" class="text-decoration-none">
                        <?php echo htmlspecialchars($settings['admin_email']); ?>
                    </a>
                </div>
            <?php endif; ?>
            
            <?php if (!empty($settings['whatsapp_number'])): ?>
                <div class="col-md-4 text-center">
                    <i class="fab fa-whatsapp fa-2x text-success mb-3"></i>
                    <h5>WhatsApp</h5>
                    <a href="https://wa.me/<?php echo preg_replace('/[^0-9]/', '', $settings['whatsapp_number']); ?>" target="_blank" class="text-decoration-none">
                        <?php echo htmlspecialchars($settings['whatsapp_number']); ?>
                    </a>
                </div>
            <?php endif; ?>
        </div>
    </div>
</section>

includes/email-processor.php

<?php
/**
 * Email Queue Processor
 * File: includes/email-processor.php
 * Description: Processes queued emails and sends notifications
 * Run via cron job: php /path/to/email-processor.php
 */

// Initialize database connection
require_once __DIR__ . '/../config.php';

class EmailProcessor {
    private $db;
    private $batch_size = 10;
    private $max_retries = 3;
    
    public function __construct($db) {
        $this->db = $db;
    }
    
    /**
     * Process queued emails
     */
    public function processQueue() {
        try {
            // Get unsent emails
            $stmt = $this->db->prepare("
                SELECT * FROM email_queue 
                WHERE sent_at IS NULL AND attempts < ?
                LIMIT ?
            ");
            
            $stmt->execute([$this->max_retries, $this->batch_size]);
            $emails = $stmt->fetchAll(PDO::FETCH_ASSOC);
            
            $sent_count = 0;
            $failed_count = 0;
            
            foreach ($emails as $email) {
                if ($this->sendEmail($email)) {
                    // Mark as sent
                    $update_stmt = $this->db->prepare("
                        UPDATE email_queue 
                        SET sent_at = NOW(), attempts = attempts + 1 
                        WHERE id = ?
                    ");
                    $update_stmt->execute([$email['id']]);
                    $sent_count++;
                } else {
                    // Increment attempts
                    $update_stmt = $this->db->prepare("
                        UPDATE email_queue 
                        SET attempts = attempts + 1 
                        WHERE id = ?
                    ");
                    $update_stmt->execute([$email['id']]);
                    $failed_count++;
                }
            }
            
            return [
                'sent' => $sent_count,
                'failed' => $failed_count,
                'total' => count($emails)
            ];
            
        } catch (PDOException $e) {
            error_log("Email queue processing error: " . $e->getMessage());
            return false;
        }
    }
    
    /**
     * Send individual email
     */
    private function sendEmail($email) {
        try {
            $to = filter_var($email['to_email'], FILTER_VALIDATE_EMAIL);
            if (!$to) {
                error_log("Invalid email address: " . $email['to_email']);
                return false;
            }
            
            $subject = $email['subject'];
            $body = $email['body'];
            
            // Prepare email headers
            $headers = "MIME-Version: 1.0\r\n";
            $headers .= "Content-type: text/plain; charset=UTF-8\r\n";
            $headers .= "From: noreply@abizglobal.com\r\n";
            
            // Send email using PHP's mail function
            // For production, consider using a proper SMTP library like PHPMailer
            $result = mail($to, $subject, $body, $headers);
            
            if ($result) {
                error_log("Email sent to: " . $to);
                return true;
            } else {
                error_log("Failed to send email to: " . $to);
                return false;
            }
            
        } catch (Exception $e) {
            error_log("Email sending exception: " . $e->getMessage());
            return false;
        }
    }
}

// Run processor if this file is executed directly
if (php_sapi_name() === 'cli') {
    try {
        $processor = new EmailProcessor($pdo);
        $result = $processor->processQueue();
        echo "Email processing completed: ";
        echo $result['sent'] . " sent, " . $result['failed'] . " failed\n";
    } catch (Exception $e) {
        echo "Error: " . $e->getMessage() . "\n";
    }
}

includes/footer.php

<?php
/**
 * Frontend Footer Component
 * File: includes/footer.php
 * Description: Main frontend footer with social links and company info
 */

// Fetch site settings
$settings = [];
if (isset($db)) {
    try {
        $stmt = $db->query("SELECT * FROM site_settings WHERE id = 1");
        $settings = $stmt->fetch(PDO::FETCH_ASSOC) ?: [];
    } catch (PDOException $e) {
        error_log("Footer: Could not fetch site settings - " . $e->getMessage());
    }
}

?>
    <!-- Footer -->
    <footer class="bg-dark text-light py-5 mt-5">
        <div class="container">
            <div class="row mb-4">
                <!-- Company Info -->
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="mb-3">
                        <?php if (!empty($settings['logo_dark'])): ?>
                            <img src="uploads/<?php echo htmlspecialchars($settings['logo_dark']); ?>" alt="Logo" style="height: 30px; margin-right: 10px;">
                        <?php endif; ?>
                        <?php echo htmlspecialchars($settings['site_title'] ?? 'ABIZ Global Services'); ?>
                    </h5>
                    <p class="small text-muted">
                        <?php echo htmlspecialchars($settings['footer_text'] ?? ' 2025 ABIZ Global. All rights reserved.'); ?>
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="mb-3">Quick Links</h5>
                    <ul class="list-unstyled small">
                        <li><a href="/?page=home" class="text-decoration-none text-muted">Home</a></li>
                        <li><a href="/?page=services" class="text-decoration-none text-muted">Services</a></li>
                        <li><a href="/?page=portfolio" class="text-decoration-none text-muted">Portfolio</a></li>
                        <li><a href="/?page=blog" class="text-decoration-none text-muted">Blog</a></li>
                        <li><a href="/?page=contact" class="text-decoration-none text-muted">Contact</a></li>
                    </ul>
                </div>
                
                <!-- Contact & Social -->
                <div class="col-md-4">
                    <h5 class="mb-3">Connect With Us</h5>
                    <p class="small text-muted">
                        <?php if (!empty($settings['phone_number'])): ?>
                            <i class="fas fa-phone"></i> 
                            <a href="tel:<?php echo htmlspecialchars($settings['phone_number']); ?>" class="text-muted text-decoration-none">
                                <?php echo htmlspecialchars($settings['phone_number']); ?>
                            </a><br>
                        <?php endif; ?>
                        <?php if (!empty($settings['admin_email'])): ?>
                            <i class="fas fa-envelope"></i> 
                            <a href="mailto:<?php echo htmlspecialchars($settings['admin_email']); ?>" class="text-muted text-decoration-none">
                                <?php echo htmlspecialchars($settings['admin_email']); ?>
                            </a>
                        <?php endif; ?>
                    </p>
                    
                    <!-- Social Links -->
                    <div class="mt-3">
                        <?php if (!empty($settings['social_fb'])): ?>
                            <a href="<?php echo htmlspecialchars($settings['social_fb']); ?>" target="_blank" class="text-muted me-3">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                        <?php endif; ?>
                        <?php if (!empty($settings['social_li'])): ?>
                            <a href="<?php echo htmlspecialchars($settings['social_li']); ?>" target="_blank" class="text-muted me-3">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        <?php endif; ?>
                        <?php if (!empty($settings['social_ig'])): ?>
                            <a href="<?php echo htmlspecialchars($settings['social_ig']); ?>" target="_blank" class="text-muted me-3">
                                <i class="fab fa-instagram"></i>
                            </a>
                        <?php endif; ?>
                        <?php if (!empty($settings['social_tw'])): ?>
                            <a href="<?php echo htmlspecialchars($settings['social_tw']); ?>" target="_blank" class="text-muted me-3">
                                <i class="fab fa-twitter"></i>
                            </a>
                        <?php endif; ?>
                        <?php if (!empty($settings['social_yt'])): ?>
                            <a href="<?php echo htmlspecialchars($settings['social_yt']); ?>" target="_blank" class="text-muted">
                                <i class="fab fa-youtube"></i>
                            </a>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            
            <hr class="bg-secondary opacity-25">
            
            <!-- Copyright -->
            <div class="row">
                <div class="col-md-12 text-center">
                    <p class="small text-muted mb-0">
                         <?php echo date('Y'); ?> <?php echo htmlspecialchars($settings['site_title'] ?? 'ABIZ Global Services'); ?>. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/script.js"></script>
    
    <style>
        footer {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            margin-top: auto;
        }
        
        footer a {
            transition: color 0.3s ease;
        }
        
        footer a:hover {
            color: #6366f1 !important;
        }
        
        footer h5 {
            font-weight: 600;
            color: #e2e8f0;
        }
    </style>
</body>
</html>

includes/header.php

<?php
/**
 * Frontend Header Component
 * File: includes/header.php
 * Description: Main frontend navigation header with responsive design
 * Colors & Design: Preserved from original
 */

// Fetch site settings
$site_title = 'ABIZ Global Services';
$settings = [];

if (isset($db)) {
    try {
        $stmt = $db->query("SELECT * FROM site_settings WHERE id = 1");
        $settings = $stmt->fetch(PDO::FETCH_ASSOC) ?: [];
        $site_title = $settings['site_title'] ?? 'ABIZ Global Services';
    } catch (PDOException $e) {
        error_log("Header: Could not fetch site settings - " . $e->getMessage());
    }
}

// Get current page for active nav highlighting
$current_page = basename($_SERVER['PHP_SELF']);
$request_uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

// Navigation items
$nav_items = [
    ['url' => '/?page=home', 'name' => 'Home', 'page' => 'home'],
    ['url' => '/?page=services', 'name' => 'Services', 'page' => 'services'],
    ['url' => '/?page=portfolio', 'name' => 'Portfolio', 'page' => 'portfolio'],
    ['url' => '/?page=products', 'name' => 'Products', 'page' => 'products'],
    ['url' => '/?page=blog', 'name' => 'Blog', 'page' => 'blog'],
    ['url' => '/?page=contact', 'name' => 'Contact', 'page' => 'contact'],
];

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo htmlspecialchars($site_title); ?></title>
    <meta name="description" content="<?php echo htmlspecialchars($settings['seo_description'] ?? 'ABIZ Global Services - Web Development, SEO, and Digital Solutions'); ?>">
    <meta name="keywords" content="web development, SEO, digital marketing, ABIZ">
    <meta name="author" content="<?php echo htmlspecialchars($site_title); ?>">
    
    <!-- Favicon -->
    <?php if (!empty($settings['favicon_path'])): ?>
        <link rel="icon" type="image/png" href="uploads/<?php echo htmlspecialchars($settings['favicon_path']); ?>">
    <?php endif; ?>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/style.css">
    
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --dark-bg: #0f172a;
            --text-light: #e2e8f0;
            --border-color: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header Styles */
        header {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar {
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color) !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .navbar-brand img {
            height: 40px;
            width: auto;
        }
        
        .navbar-nav .nav-link {
            color: #333 !important;
            font-weight: 500;
            margin: 0 0.5rem;
            position: relative;
            transition: color 0.3s ease;
        }
        
        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            color: var(--primary-color) !important;
        }
        
        .navbar-nav .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-color);
        }
        
        .btn-contact {
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-contact:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }
        
        /* Mobile Menu */
        @media (max-width: 768px) {
            .navbar-nav {
                padding-top: 1rem;
            }
            
            .navbar-nav .nav-link {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .navbar-nav .nav-link.active::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <!-- Brand/Logo -->
                <a class="navbar-brand" href="/?page=home">
                    <?php if (!empty($settings['logo_light'])): ?>
                        <img src="uploads/<?php echo htmlspecialchars($settings['logo_light']); ?>" alt="<?php echo htmlspecialchars($site_title); ?>">
                    <?php else: ?>
                        <i class="fas fa-rocket"></i> ABIZ
                    <?php endif; ?>
                </a>
                
                <!-- Mobile Toggle Button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <!-- Navigation Links -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center gap-2">
                        <?php foreach ($nav_items as $item): 
                            $is_active = ($item['page'] === ($page ?? 'home')) ? 'active' : '';
                        ?>
                            <li class="nav-item">
                                <a class="nav-link <?php echo $is_active; ?>" href="<?php echo htmlspecialchars($item['url']); ?>">
                                    <?php echo htmlspecialchars($item['name']); ?>
                                </a>
                            </li>
                        <?php endforeach; ?>
                        <li class="nav-item">
                            <a href="/?page=contact" class="btn btn-contact">Get Started</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

includes/homepage.php

<?php
// Include header with SEO optimization
include 'header.php';

// Fetch data for homepage
try {
    // Fetch 3 services for preview
    $services_stmt = $db->query("SELECT * FROM services ORDER BY created_at DESC LIMIT 3");
    $services = $services_stmt->fetchAll(PDO::FETCH_ASSOC);

    // Fetch 3 latest portfolio projects
    $portfolio_stmt = $db->query("SELECT * FROM portfolio ORDER BY created_at DESC LIMIT 3");
    $portfolio = $portfolio_stmt->fetchAll(PDO::FETCH_ASSOC);
    
} catch (PDOException $e) {
    // Display a default message if DB fails, but don't halt the whole site
    $error_message = "Could not load content: " . $e->getMessage();
    $services = [];
    $portfolio = [];
}
?>

<!-- Hero Section -->
<section class="hero-bg py-20 md:py-32 text-white border-b border-gray-700 relative overflow-hidden">
    <!-- Particles Container -->
    <div id="particles-js"></div> 
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center hero-content">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight transform translate-y-0 opacity-100 transition-all duration-700 ease-out">
            Digital Transformation for <span class="text-blue-400">Ambitious Businesses</span>
        </h1>
        <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto transform translate-y-0 opacity-100 transition-all duration-700 delay-150 ease-out">
            ABIZ Global Services delivers cutting-edge Web Development, strategic SEO, and high-value Digital Assets to accelerate your growth.
        </p>
        <div class="flex justify-center space-x-4">
            <a href="services" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg shadow-xl shadow-blue-500/30 transform hover:scale-[1.02]">
                Explore Services
            </a>
            <a href="contact" class="bg-transparent border-2 border-gray-400 hover:border-blue-400 text-gray-300 hover:text-blue-400 font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg transform hover:scale-[1.02]">
                Get a Free Quote
            </a>
        </div>
    </div>
</section>

<!-- Services Preview Section (AOS Added) -->
<section class="py-16 md:py-24 bg-gray-50 dark:bg-gray-900 animate-on-scroll">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-base font-semibold text-blue-600 uppercase tracking-wider">What We Do</h2>
            <p class="mt-2 text-3xl font-extrabold text-gray-900 dark:text-white sm:text-4xl">
                Our Core Services
            </p>
            <p class="mt-4 text-xl text-gray-500 dark:text-gray-400 max-w-3xl mx-auto">
                Comprehensive solutions tailored for digital success, managed by expert teams.
            </p>
        </div>

        <?php if (!empty($services)): ?>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <?php foreach ($services as $service): ?>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transform hover:shadow-2xl hover:scale-[1.02] transition duration-300 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-center space-x-4 mb-4">
                            <?php if ($service['icon']): ?>
                                <i class="<?php echo htmlspecialchars($service['icon']); ?> fa-3x text-blue-500 dark:text-blue-400 transition-colors duration-300"></i>
                            <?php else: ?>
                                <i class="fa-solid fa-star fa-3x text-blue-500 dark:text-blue-400 transition-colors duration-300"></i>
                            <?php endif; ?>
                            <h3 class="text-2xl font-bold text-gray-900 dark:text-white"><?php echo htmlspecialchars($service['name']); ?></h3>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-3">
                            <?php echo htmlspecialchars($service['description']); ?>
                        </p>
                        <a href="services" class="text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 transition duration-300 flex items-center">
                            Learn More 
                            <i class="fa-solid fa-arrow-right w-4 h-4 ml-1 transition-transform duration-300 group-hover:translate-x-1"></i>
                        </a>
                    </div>
                <?php endforeach; ?>
            </div>
            <div class="text-center mt-10">
                <a href="services" class="bg-gray-800 dark:bg-gray-700 hover:bg-gray-700 dark:hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg transform hover:scale-[1.02]">
                    View All Services
                </a>
            </div>
        <?php else: ?>
            <div class="text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-xl">
                <p class="text-red-500 font-semibold mb-2">No Services Added.</p>
                <p class="text-gray-600 dark:text-gray-400">Please add services through the <a href="admin/dashboard.php" class="text-blue-500 hover:underline">Admin Panel</a> to display them here.</p>
            </div>
        <?php endif; ?>
    </div>
</section>

<!-- New Section: Pricing Packages (AOS Added) -->
<section class="py-16 md:py-24 hero-bg text-white animate-on-scroll border-t border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-base font-semibold text-blue-400 uppercase tracking-wider">Affordable Solutions</h2>
            <p class="mt-2 text-3xl font-extrabold text-white sm:text-4xl">
                Our Standard Pricing Packages
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch">
            
            <?php 
            $packages = [
                ['Starter', 'Essential services to get you online.', '$499', ['1 Project Management', 'Basic SEO Audit', 'Graphics Design (5 Assets)', '1 Month Support']],
                ['Professional', 'Balanced services for growth and stability.', '$999', ['2 Project Management', 'Advanced SEO Strategy', 'Graphics Design (15 Assets)', '3 Months Support', 'SMM Strategy']],
                ['Enterprise', 'Full-scale solution for dominating the market.', '$1999', ['Dedicated Project Manager', 'Full-Scale SEO & Automation', 'Unlimited Graphics Design', '6 Months Priority Support', 'Python Scripting']]
            ];
            $whatsapp_num = $settings['whatsapp_number'] ?? '';
            $is_whatsapp_set = !empty($whatsapp_num);

            foreach($packages as $package):
                $title = $package[0];
                $price = $package[2];
                $desc = $package[1];
                $features = $package[3];
                $is_popular = ($title === 'Professional');
                
                $wa_message = urlencode("Hello ABIZ Global Services, I'm interested in the '{$title} Package' priced at {$price}. Let's discuss.");
                $wa_link = $is_whatsapp_set ? "https://wa.me/{$whatsapp_num}?text={$wa_message}" : 'contact';
            ?>
            <div class="relative bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl border-2 h-full flex flex-col justify-between 
                        <?php echo $is_popular ? 'border-blue-600 transform scale-[1.03]' : 'border-gray-200 dark:border-gray-700'; ?> 
                        text-gray-900 dark:text-gray-100 transition duration-300 hover:shadow-blue-500/50 hover:shadow-2xl">
                
                <?php if ($is_popular): ?>
                    <span class="absolute top-0 right-0 bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-bl-lg rounded-tr-xl">Most Popular</span>
                <?php endif; ?>

                <div>
                    <h3 class="text-2xl font-extrabold mb-2 text-gray-900 dark:text-white"><?php echo $title; ?></h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-4"><?php echo $desc; ?></p>
                    
                    <p class="text-4xl font-extrabold mb-6 text-blue-600 dark:text-blue-400"><?php echo $price; ?></p>
                    
                    <ul class="space-y-3 mb-8 text-gray-700 dark:text-gray-300">
                        <?php foreach ($features as $feature): ?>
                            <li class="flex items-center">
                                <i class="fa-solid fa-check text-green-500 mr-3"></i> <?php echo $feature; ?>
                            </li>
                        <?php endforeach; ?>
                    </ul>
                </div>
                
                <a href="<?php echo htmlspecialchars($wa_link); ?>" 
                   <?php echo $is_whatsapp_set ? 'target="_blank"' : 'disabled'; ?>
                   class="w-full inline-flex justify-center items-center font-semibold py-3 px-4 rounded-lg 
                          transition-all duration-300 shadow-md transform hover:scale-[1.01]
                          <?php echo $is_whatsapp_set 
                                ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                : 'bg-gray-400 text-gray-800 cursor-not-allowed shadow-none hover:bg-gray-400'; 
                          ?>">
                    <i class="fa-brands fa-whatsapp mr-2"></i> Get This Package
                </a>
            </div>
            <?php endforeach; ?>
        </div>
        <div class="text-center mt-12">
            <a href="packages" class="text-lg font-semibold text-blue-400 hover:text-blue-300 transition-colors duration-300">
                View All Custom Packages 
            </a>
        </div>
    </div>
</section>

<!-- New Section: Why Choose Us? (AOS Added) -->
<section class="py-16 md:py-24 bg-white dark:bg-gray-800 animate-on-scroll">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-base font-semibold text-blue-600 uppercase tracking-wider">The ABIZ Advantage</h2>
            <p class="mt-2 text-3xl font-extrabold text-gray-900 dark:text-white sm:text-4xl">
                Why Choose Us?
            </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
            <div class="text-center p-6 bg-gray-50 dark:bg-gray-900 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 transform hover:shadow-2xl transition duration-300">
                <i class="fa-solid fa-medal fa-3x text-blue-600 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Result-Oriented Approach</h3>
                <p class="text-gray-600 dark:text-gray-400">We focus solely on delivering measurable results, guaranteeing a positive ROI for our clients.</p>
            </div>
            <div class="text-center p-6 bg-gray-50 dark:bg-gray-900 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 transform hover:shadow-2xl transition duration-300">
                <i class="fa-solid fa-headset fa-3x text-blue-600 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">24/7 Expert Support</h3>
                <p class="text-gray-600 dark:text-gray-400">Our dedicated team provides round-the-clock support across all time zones for seamless operations.</p>
            </div>
            <div class="text-center p-6 bg-gray-50 dark:bg-gray-900 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 transform hover:shadow-2xl transition duration-300">
                <i class="fa-solid fa-code fa-3x text-blue-600 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Cutting-Edge Technology</h3>
                <p class="text-gray-600 dark:text-gray-400">We utilize the latest frameworks and automation tools to deliver fast, scalable, and modern solutions.</p>
            </div>
        </div>
    </div>
</section>

<!-- Portfolio Preview Section (AOS Added) -->
<section class="py-16 md:py-24 bg-gray-50 dark:bg-gray-900 animate-on-scroll">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-base font-semibold text-blue-600 uppercase tracking-wider">Our Recent Work</h2>
            <p class="mt-2 text-3xl font-extrabold text-gray-900 dark:text-white sm:text-4xl">
                Case Studies & Success Stories
            </p>
        </div>

        <?php if (!empty($portfolio)): ?>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <?php foreach ($portfolio as $project): ?>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-100 dark:border-gray-700 group transform hover:shadow-2xl hover:scale-[1.02] transition duration-300">
                        <div class="h-48 overflow-hidden">
                            <?php if ($project['image_path']): ?>
                                <img src="uploads/portfolio/<?php echo htmlspecialchars($project['image_path']); ?>" 
                                     alt="<?php echo htmlspecialchars($project['title']); ?>" 
                                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            <?php else: ?>
                                <div class="w-full h-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400">No Image</div>
                            <?php endif; ?>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 truncate"><?php echo htmlspecialchars($project['title']); ?></h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-3">
                                <?php echo strip_tags($project['description']); ?>
                            </p>
                            <a href="portfolio/<?php echo $project['id']; ?>" class="text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 transition duration-300 flex items-center">
                                View Case Study
                                <i class="fa-solid fa-arrow-right w-4 h-4 ml-1 transition-transform duration-300 group-hover:translate-x-1"></i>
                            </a>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
            <div class="text-center mt-10">
                <a href="portfolio" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full transition-colors duration-300 text-lg shadow-lg shadow-blue-500/50 transform hover:scale-[1.02]">
                    View Full Portfolio
                </a>
            </div>
        <?php else: ?>
             <div class="text-center p-8 bg-gray-100 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700">
                <p class="text-red-500 font-semibold mb-2">No Portfolio Projects Added.</p>
                <p class="text-gray-600 dark:text-gray-400">Please add projects through the <a href="admin/dashboard.php" class="text-blue-500 hover:underline">Admin Panel</a> to display them here.</p>
            </div>
        <?php endif; ?>
    </div>
</section>

<!-- New Section: Our Team (AOS Added) -->
<section class="py-16 md:py-24 bg-white dark:bg-gray-800 animate-on-scroll">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-base font-semibold text-blue-600 uppercase tracking-wider">Meet The Experts</h2>
            <p class="mt-2 text-3xl font-extrabold text-gray-900 dark:text-white sm:text-4xl">
                The Driving Force Behind ABIZ
            </p>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
            <div class="transform hover:scale-[1.05] transition duration-300">
                <img src="https://placehold.co/300x300/1e293b/FFFFFF?text=CEO" alt="Team Member 1" class="w-full h-auto object-cover rounded-xl shadow-lg mb-4 border-4 border-blue-500/50">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Muhammad A.</h3>
                <p class="text-blue-600 dark:text-blue-400">Founder & CEO</p>
            </div>
             <div class="transform hover:scale-[1.05] transition duration-300">
                <img src="https://placehold.co/300x300/1e293b/FFFFFF?text=CTO" alt="Team Member 2" class="w-full h-auto object-cover rounded-xl shadow-lg mb-4 border-4 border-blue-500/50">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Fatima K.</h3>
                <p class="text-blue-600 dark:text-blue-400">CTO, Web Development</p>
            </div>
             <div class="transform hover:scale-[1.05] transition duration-300">
                <img src="https://placehold.co/300x300/1e293b/FFFFFF?text=SEO+Lead" alt="Team Member 3" class="w-full h-auto object-cover rounded-xl shadow-lg mb-4 border-4 border-blue-500/50">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Ali R.</h3>
                <p class="text-blue-600 dark:text-blue-400">Head of SEO & Marketing</p>
            </div>
             <div class="transform hover:scale-[1.05] transition duration-300">
                <img src="https://placehold.co/300x300/1e293b/FFFFFF?text=Design+Lead" alt="Team Member 4" class="w-full h-auto object-cover rounded-xl shadow-lg mb-4 border-4 border-blue-500/50">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Sana B.</h3>
                <p class="text-blue-600 dark:text-blue-400">Creative Design Lead</p>
            </div>
        </div>
    </div>
</section>

<!-- New Section: Testimonials (AOS Added) -->
<section class="py-16 md:py-24 hero-bg text-white animate-on-scroll">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center hero-content">
        <h2 class="text-base font-semibold text-blue-400 uppercase tracking-wider">Client Love</h2>
        <p class="mt-2 text-3xl font-extrabold text-white sm:text-4xl mb-10">
            What Our Clients Say
        </p>

        <!-- Mock Testimonial Carousel Item -->
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl">
            <p class="text-xl font-medium text-gray-800 dark:text-gray-200 italic mb-6">
                "ABIZ Global Services took our website from zero to hero! Their SEO strategies are unmatched, and the custom Python automation they built saved our team countless hours. Truly a game-changer for our business."
            </p>
            <div class="flex flex-col items-center">
                <div class="text-2xl text-yellow-500 mb-2">
                    <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                </div>
                <p class="font-bold text-gray-900 dark:text-white">Ahmed S.</p>
                <p class="text-sm text-blue-600 dark:text-blue-400">CEO, TechForward Solutions</p>
            </div>
        </div>
    </div>
</section>

<!-- Initialization Script for Particles and AOS -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Particles.js Initialization (for Hero Section)
        try {
            particlesJS('particles-js', {
                "particles": {
                    "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
                    "color": { "value": "#ffffff" },
                    "shape": { "type": "circle", "stroke": { "width": 0, "color": "#000000" } },
                    "opacity": { "value": 0.5, "random": false, "anim": { "enable": false } },
                    "size": { "value": 3, "random": true, "anim": { "enable": false } },
                    "line_linked": { "enable": true, "distance": 150, "color": "#3b82f6", "opacity": 0.4, "width": 1 },
                    "move": { "enable": true, "speed": 4, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false, "attract": { "enable": false } }
                },
                "interactivity": {
                    "detect_on": "canvas",
                    "events": { "onhover": { "enable": true, "mode": "repulse" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                    "modes": { "repulse": { "distance": 100, "duration": 0.4 } }
                },
                "retina_detect": true
            });
        } catch (e) {
            console.error("Particles.js failed to initialize:", e);
        }

        // 2. Animate On Scroll (AOS) & Lazy Loading Initialization
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    // Stop observing once visible
                    observer.unobserve(entry.target);
                }
            });
        }, {
            // Root Margin: start loading slightly before user reaches the section
            rootMargin: '0px 0px -100px 0px', 
            threshold: 0.1 
        });

        document.querySelectorAll('.animate-on-scroll').forEach(section => {
            observer.observe(section);
        });
    });
</script>

<?php 
// Include footer
include 'footer.php'; 
?>

includes/portfolio.php

<?php
// Set Page SEO
$page_seo_title = 'Our Full Portfolio';
$page_seo_desc = 'View our detailed case studies and success stories in web development, SEO, graphic design, and automation.';
$page_seo_keywords = 'portfolio, case studies, abiz global projects, web development work, seo results';

// Include header with SEO optimization
include 'header.php';

// Fetch all portfolio projects
try {
    // FIX 3: Use prepare/execute even for simple SELECT for robust PDO error handling
    $portfolio_stmt = $db->prepare("SELECT * FROM portfolio ORDER BY created_at DESC");
    $portfolio_stmt->execute();
    $portfolio = $portfolio_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error_message = "Could not load portfolio: " . $e->getMessage();
    $portfolio = [];
}
?>

<!-- Portfolio Hero/Header -->
<section class="bg-gray-800 dark:bg-gray-950 py-16 text-white border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="4xl:text-5xl font-extrabold mb-3">
            Our <span class="text-blue-400">Success Stories</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-300 max-w-4xl mx-auto">
            Explore our best work across various industries and digital domains.
        </p>
    </div>
</section>

<!-- Portfolio Grid -->
<section class="py-16 md:py-24 bg-gray-50 dark:bg-gray-900 animate-on-scroll">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <?php if (isset($error_message)): ?>
            <div class="text-center p-12 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                <h2 class="text-3xl font-bold text-red-600 mb-4">Error Loading Data</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400">
                    Database Error: <?php echo htmlspecialchars($error_message); ?>
                </p>
                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm">Please ensure you ran the seed files correctly: `seed_portfolio.php` and `seed_junction.php`.</p>
            </div>
        <?php elseif (!empty($portfolio)): ?>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <?php foreach ($portfolio as $project): ?>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-100 dark:border-gray-700 group transform hover:shadow-2xl hover:scale-[1.02] transition duration-300">
                        <div class="h-56 overflow-hidden">
                            <?php if ($project['image_path']): ?>
                                <img src="uploads/portfolio/<?php echo htmlspecialchars($project['image_path']); ?>" 
                                     alt="<?php echo htmlspecialchars($project['title']); ?>" 
                                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            <?php else: ?>
                                <div class="w-full h-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-xl font-semibold">No Image</div>
                            <?php endif; ?>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 truncate"><?php echo htmlspecialchars($project['title']); ?></h3>
                            <div class="flex items-center mb-4">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-400 mr-2">Rating:</span>
                                <span class="text-yellow-500">
                                    <?php 
                                        $rating = $project['rating'] ?? 5;
                                        for ($i = 0; $i < 5; $i++) {
                                            echo ($i < $rating) ? '<i class="fa-solid fa-star"></i>' : '<i class="fa-regular fa-star"></i>';
                                        }
                                    ?>
                                </span>
                            </div>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-3">
                                <?php echo strip_tags($project['description']); ?>
                            </p>
                            <a href="portfolio/<?php echo $project['id']; ?>" class="text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 transition duration-300 flex items-center">
                                View Case Study
                                <i class="fa-solid fa-arrow-right w-4 h-4 ml-1 transition-transform duration-300 group-hover:translate-x-1"></i>
                            </a>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php else: ?>
            <div class="text-center p-12 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                <h2 class="text-3xl font-bold text-red-600 mb-4">Portfolio Empty</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400">
                    No projects available at the moment. Please check back later.
                </p>
                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm">Please ensure you ran the seed files correctly: `seed_portfolio.php` and `seed_junction.php`.</p>
            </div>
        <?php endif; ?>
    </div>
</section>

<!-- Contact CTA Section -->
<section class="py-16 bg-blue-600 dark:bg-blue-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white">
        <h2 class="text-3xl font-extrabold mb-3">Ready to Start Your Project?</h2>
        <p class="text-xl mb-6">Let's discuss how ABIZ Global Services can help you achieve your goals.</p>
        <a href="contact" class="bg-white text-blue-600 font-semibold py-3 px-8 rounded-full hover:bg-gray-100 transition-colors shadow-lg shadow-black/30">
            Contact Us Today
        </a>
    </div>
</section>

<?php 
// Include footer
include 'footer.php'; 
?>

includes/services.php

<?php
// Set Page SEO
$page_seo_title = 'All Services';
$page_seo_desc = 'Explore our full range of services including Web Development, Graphics Design, SEO, SMM, Voice Over, Video Editing, and Python Automations.';

// Include header with SEO optimization
include 'header.php';

// Fetch all services
try {
    $services_stmt = $db->query("SELECT * FROM services ORDER BY name ASC");
    $services = $services_stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error_message = "Could not load services: " . $e->getMessage();
    $services = [];
}

// Function to fetch plans for a specific service ID
function get_service_plans($db, $service_id) {
    try {
        $stmt = $db->prepare("SELECT name, price, description, features, is_popular FROM service_plans WHERE service_id = ? ORDER BY order_index ASC");
        $stmt->execute([$service_id]);
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    } catch (PDOException $e) {
        return [];
    }
}

// Get WhatsApp number for CTAs
$whatsapp_num = $settings['whatsapp_number'] ?? '';
$is_whatsapp_set = !empty($whatsapp_num);
?>


<section class="bg-gray-800 dark:bg-gray-950 py-16 text-white border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-3">
            Our Full Range of <span class="text-blue-400">Services</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-300 max-w-4xl mx-auto">
            We provide end-to-end digital solutions, from foundational web work to advanced digital marketing and automation.
        </p>
    </div>
</section>


<section class="py-16 md:py-24 bg-gray-50 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <?php if (isset($error_message)): ?>
            <div class="text-center p-12 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                <h2 class="text-3xl font-bold text-red-600 mb-4">Error Loading Data</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400">
                    <?php echo htmlspecialchars($error_message); ?>
                </p>
            </div>
        <?php elseif (!empty($services)): ?>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <?php foreach ($services as $service): 
                    $plans = get_service_plans($db, $service['id']);
                    
                    // Short description (first 3 lines for uniformity)
                    $lines = explode("\n", htmlspecialchars($service['description']));
                    $short_desc = implode("\n", array_slice($lines, 0, 3));
                    $full_desc = nl2br(htmlspecialchars($service['description']));
                    
                    // Prepare service details for Modal
                    $service_details = [
                        'id' => $service['id'],
                        'title' => htmlspecialchars($service['name']),
                        'description' => $full_desc,
                        'icon_class' => htmlspecialchars($service['icon']),
                        'plans' => $plans,
                        'wa_link_base' => $is_whatsapp_set ? "https://wa.me/{$whatsapp_num}?text=".urlencode("Hello ABIZ Global Services, I'm interested in the '{$service['name']}' service. Please tell me more about your ") : 'contact'
                    ];
                ?>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transform hover:shadow-2xl transition duration-300 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-start space-x-4 mb-4">
                            <?php if ($service['icon']): ?>
                                <i class="<?php echo htmlspecialchars($service['icon']); ?> fa-2x text-blue-600 dark:text-blue-400 mt-1 w-8 h-8 flex-shrink-0"></i>
                            <?php else: ?>
                                <i class="fa-solid fa-briefcase fa-2x text-blue-600 dark:text-blue-400 mt-1 w-8 h-8 flex-shrink-0"></i>
                            <?php endif; ?>
                            <h3 class="text-2xl font-bold text-gray-900 dark:text-white"><?php echo htmlspecialchars($service['name']); ?></h3>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 leading-relaxed line-clamp-3">
                            <?php echo $short_desc; ?>
                        </p>
                        <?php if (!empty($plans)): ?>
                             <button data-service='<?php echo json_encode($service_details, JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP); ?>' 
                                 class="w-full open-service-modal inline-flex justify-center items-center font-semibold py-3 px-4 rounded-lg 
                                  transition-all duration-300 shadow-md transform hover:scale-[1.01]
                                  bg-blue-600 text-white hover:bg-blue-700">
                                <i class="fa-solid fa-info-circle mr-2"></i> View More & Pricing
                            </button>
                        <?php else: ?>
                            <a href="contact" class="w-full inline-flex justify-center items-center font-semibold py-3 px-4 rounded-lg 
                                transition-all duration-300 shadow-md transform hover:scale-[1.01]
                                bg-gray-400 text-gray-800 hover:bg-gray-500">
                                <i class="fa-solid fa-info-circle mr-2"></i> Contact for Quote
                            </a>
                        <?php endif; ?>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php else: ?>
            <div class="text-center p-12 bg-white dark:bg-gray-800 rounded-xl shadow-xl">
                <h2 class="text-3xl font-bold text-red-600 mb-4">Services Not Available</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400">
                    It looks like no services have been added yet. Please check back later or contact us directly.
                </p>
            </div>
        <?php endif; ?>
    </div>
</section>


<section class="py-16 bg-blue-600 dark:bg-blue-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white">
        <h2 class="text-3xl font-extrabold mb-3">Ready to Start Your Project?</h2>
        <p class="text-xl mb-6">Let's discuss how ABIZ Global Services can help you achieve your goals.</p>
        <a href="contact" class="bg-white text-blue-600 font-semibold py-3 px-8 rounded-full hover:bg-gray-100 transition-colors shadow-lg shadow-black/30">
            Contact Us Today
        </a>
    </div>
</section>

<!-- Service Modal -->
<div id="serviceModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[999] hidden backdrop-blur-sm">
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-300 ease-out" id="modalContent">
        <div class="p-6 md:p-10 relative">
            <button id="closeModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white transition-colors">
                <i class="fa-solid fa-times fa-xl"></i>
            </button>
            
            <div class="flex items-center space-x-4 mb-6 border-b pb-4 border-gray-200 dark:border-gray-700">
                <div id="modalIconContainer" class="flex-shrink-0">
                    <i id="modalIcon" class="fa-solid fa-briefcase fa-3x text-blue-600 dark:text-blue-400"></i>
                </div>
                <h2 id="modalTitle" class="text-3xl font-extrabold text-gray-900 dark:text-white">Service Title</h2>
            </div>

            <div class="grid grid-cols-1 gap-10">
                
                <!-- Pricing Plans (Top) -->
                <div class="border-b pb-8 border-gray-200 dark:border-gray-700">
                    <h3 class="text-2xl font-extrabold text-gray-800 dark:text-gray-200 mb-6">Our Flexible Pricing Plans</h3>
                    <div id="modalPricingPlans" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Plans will be inserted here -->
                    </div>
                </div>
                
                <!-- Full Details and Features -->
                <div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-3">Full Service Details</h3>
                            <div id="modalDescription" class="text-gray-600 dark:text-gray-400 leading-relaxed text-base mb-6">
                                <!-- Full description will be inserted here -->
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-3">Key Features Included</h3>
                            <ul id="modalServiceFeatures" class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-600 dark:text-gray-400 text-base">
                                <!-- Default/Generic features will be inserted here -->
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('serviceModal');
        const modalContent = document.getElementById('modalContent');
        const closeModalButton = document.getElementById('closeModal');
        const openModalButtons = document.querySelectorAll('.open-service-modal');

        const modalTitle = document.getElementById('modalTitle');
        const modalDescription = document.getElementById('modalDescription');
        const modalIcon = document.getElementById('modalIcon');
        const modalServiceFeatures = document.getElementById('modalServiceFeatures'); 
        const modalPricingPlans = document.getElementById('modalPricingPlans');
        
        const lockScroll = () => document.body.style.overflow = 'hidden';
        const unlockScroll = () => document.body.style.overflow = '';

        openModalButtons.forEach(button => {
            button.addEventListener('click', () => {
                try {
                    const serviceData = JSON.parse(button.getAttribute('data-service'));
                    
                    // Populate Modal Basic Info
                    modalTitle.textContent = serviceData.title;
                    modalDescription.innerHTML = serviceData.description;
                    modalIcon.className = serviceData.icon_class + ' fa-3x text-blue-600 dark:text-blue-400';
                    
                    // Populate Pricing Plans
                    modalPricingPlans.innerHTML = '';
                    serviceData.plans.forEach(plan => {
                        const featuresArray = JSON.parse(plan.features || '[]');
                        let featuresHtml = featuresArray.map(f => `<li class="flex items-start text-sm text-gray-700 dark:text-gray-300"><i class="fa-solid fa-check text-green-500 mr-2 mt-1 flex-shrink-0"></i> ${f}</li>`).join('');

                        const waMessage = encodeURIComponent(`Hello ABIZ Global Services, I'm interested in the "${serviceData.title}" service with the "${plan.name}" plan (${plan.price}). Let's discuss!`);
                        const waLink = serviceData.wa_link_base + waMessage;
                        
                        const isPopular = plan.is_popular === 1;

                        const planCard = document.createElement('div');
                        planCard.className = `relative p-5 rounded-xl shadow-lg border-2 h-full flex flex-col justify-between transition duration-300 transform hover:scale-[1.03] ${isPopular ? 'border-blue-600 bg-blue-50 dark:bg-gray-800' : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800'}`;
                        
                        planCard.innerHTML = `
                            ${isPopular ? '<span class="absolute top-0 right-0 bg-red-600 text-white text-xs font-bold py-1 px-3 rounded-bl-lg rounded-tr-xl">Recommended</span>' : ''}
                            <div>
                                <h4 class="text-2xl font-extrabold mb-2 ${isPopular ? 'text-blue-600 dark:text-blue-400' : 'text-gray-900 dark:text-white'}">${plan.name}</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">${plan.description}</p>
                                <p class="text-3xl font-extrabold mb-4 text-gray-900 dark:text-white">${plan.price}</p>
                                <ul class="space-y-1 mb-6">
                                    ${featuresHtml}
                                </ul>
                            </div>
                            <a href="${waLink}" target="_blank"
                               class="w-full inline-flex justify-center items-center font-semibold py-3 px-4 rounded-lg 
                                      transition-all duration-300 shadow-md transform hover:scale-[1.01]
                                      ${serviceData.wa_link_base === 'contact' ? 'bg-gray-400 text-gray-800 cursor-not-allowed shadow-none' : 'bg-green-500 text-white hover:bg-green-600'}">
                                <i class="fa-brands fa-whatsapp mr-2"></i> ${plan.name.includes('Custom') ? 'Get Custom Quote' : 'Discuss & Buy Now'}
                            </a>
                        `;
                        modalPricingPlans.appendChild(planCard);
                    });

                    // Populate Service Specific Features (Generic/Default features)
                    modalServiceFeatures.innerHTML = '';
                    const defaultServiceFeatures = [
                        "24/7 Dedicated Support", "Weekly Progress Reports", "Custom Strategy Implementation", "Dedicated Project Manager", 
                        "Scalable Solutions", "100% Transparency", "Guaranteed Results"
                    ];
                    defaultServiceFeatures.forEach(feature => {
                        const li = document.createElement('li');
                        li.className = 'flex items-start';
                        li.innerHTML = '<i class="fa-solid fa-check text-green-500 mr-3 mt-1 flex-shrink-0"></i> ' + feature;
                        modalServiceFeatures.appendChild(li);
                    });

                    // Show Modal with animation
                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                    }, 50);
                    lockScroll();

                } catch (e) {
                    console.error("Error parsing service data or initializing modal:", e);
                    alert("Error: Could not load service details. Please check Admin Panel configuration.");
                }
            });
        });

        // Modal Close Logic
        [closeModalButton, modal].forEach(el => {
            if (el) {
                el.addEventListener('click', (e) => {
                    if (e.target === modal || e.target === closeModalButton || e.target.closest('#closeModal')) {
                        modalContent.classList.remove('scale-100', 'opacity-100');
                        modalContent.classList.add('scale-95', 'opacity-0');
                        setTimeout(() => {
                            modal.classList.add('hidden');
                            unlockScroll();
                            // Clear plans content when closing
                            modalPricingPlans.innerHTML = '';
                        }, 300); 
                    }
                });
            }
        });
        
    });
</script>

<?php 
include 'footer.php'; 
?>

install/database.sql

-- ABIZ Global Services CMS Database Structure
-- Version: 1.3
-- Fixes: Correct table creation order (dependencies first) and includes all columns
-- (logo_dark, site_url, footer_text, service_plans table).

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";

-- 1. `admin_users` (No dependencies)
CREATE TABLE `admin_users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(100) NOT NULL,
  `password` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 2. `services` (No dependencies)
CREATE TABLE `services` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `icon` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 3. `portfolio` (No dependencies)
CREATE TABLE `portfolio` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `image_path` varchar(255) DEFAULT NULL,
  `client_name` varchar(255) DEFAULT NULL,
  `client_review` text DEFAULT NULL,
  `rating` int(1) DEFAULT 5,
  `seo_title` varchar(255) DEFAULT NULL,
  `seo_desc` text DEFAULT NULL,
  `seo_keywords` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 4. `products` (No dependencies)
CREATE TABLE `products` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `price` varchar(100) DEFAULT NULL,
  `image_path` varchar(255) DEFAULT NULL,
  `seo_title` varchar(255) DEFAULT NULL,
  `seo_desc` text DEFAULT NULL,
  `seo_keywords` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 5. `blog_posts` (Depends on `admin_users`)
CREATE TABLE `blog_posts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `content` longtext DEFAULT NULL,
  `image_path` varchar(255) DEFAULT NULL,
  `author_id` int(11) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `status` enum('published','draft','scheduled') NOT NULL DEFAULT 'draft',
  `publish_at` datetime DEFAULT NULL,
  `slug` varchar(255) NOT NULL,
  `seo_title` varchar(255) DEFAULT NULL,
  `seo_desc` text DEFAULT NULL,
  `seo_keywords` text DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `slug` (`slug`),
  KEY `fk_author_id` (`author_id`),
  CONSTRAINT `fk_author_id` FOREIGN KEY (`author_id`) REFERENCES `admin_users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 6. `contact_enquiries` (No dependencies)
CREATE TABLE `contact_enquiries` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `phone` varchar(50) DEFAULT NULL,
  `message` text NOT NULL,
  `received_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `is_read` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 7. `site_settings` (No dependencies)
-- Includes ALL columns: logo_dark, logo_light, site_url, footer_text
CREATE TABLE `site_settings` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `site_title` varchar(255) NOT NULL,
  `admin_email` varchar(255) DEFAULT NULL,
  `phone_number` varchar(50) DEFAULT NULL,
  `whatsapp_number` varchar(50) DEFAULT NULL,
  `logo_path` varchar(255) DEFAULT NULL,
  `favicon_path` varchar(255) DEFAULT NULL,
  `social_fb` varchar(255) DEFAULT NULL,
  `social_li` varchar(255) DEFAULT NULL,
  `social_yt` varchar(255) DEFAULT NULL,
  `social_tw` varchar(255) DEFAULT NULL,
  `social_ig` varchar(255) DEFAULT NULL,
  `logo_dark` varchar(255) DEFAULT NULL,
  `logo_light` varchar(255) DEFAULT NULL,
  `site_url` varchar(255) DEFAULT NULL,
  `footer_text` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 8. `portfolio_services_junction` (Depends on `portfolio` and `services`)
CREATE TABLE `portfolio_services_junction` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `portfolio_id` int(11) NOT NULL,
  `service_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_portfolio_id` (`portfolio_id`),
  KEY `fk_service_id` (`service_id`),
  CONSTRAINT `fk_portfolio_id` FOREIGN KEY (`portfolio_id`) REFERENCES `portfolio` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_service_id` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 9. `service_plans` (Depends on `services`)
CREATE TABLE `service_plans` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `service_id` int(11) NOT NULL,
  `plan_name` varchar(255) NOT NULL,
  `price` varchar(100) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `features` text DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_plan_service_id` (`service_id`),
  CONSTRAINT `fk_plan_service_id` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Insert default site settings (Row ID 1)
INSERT INTO `site_settings` (`id`, `site_title`, `footer_text`) VALUES
(1, 'ABIZ Global Services', ' 2025 ABIZ Global. All rights reserved.');

COMMIT;

install/install_success.php

<?php
/*
 * ABIZ Global Services - Install Success
 * This page acts as a buffer.
 * install.php auto-deletes itself and then redirects here.
 * This page then redirects to the admin panel.
 */

// Set a short delay to ensure session is written if needed
session_start();

// Unset any installer session variables if they exist
unset($_SESSION['install_data']);

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installation Successful</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
    <!-- Redirect to admin panel after 3 seconds -->
    <meta http-equiv="refresh" content="3;url=../admin/index.php">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <div class="w-full max-w-lg bg-white rounded-xl shadow-2xl overflow-hidden text-center p-10">
        <i class="fa-solid fa-check-circle text-6xl text-green-500 mb-6"></i>
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Installation Successful!</h1>
        <p class="text-gray-600 text-lg mb-8">
            Your CMS has been installed correctly. The installer files have been deleted.
        </p>
        <p class="text-gray-500">
            You will be redirected to the admin login page in 3 seconds.
        </p>
        <a href="../admin/index.php" class="mt-6 inline-block text-blue-600 hover:text-blue-800 font-medium">
            Click here if you are not redirected
        </a>
    </div>

</body>
</html>

install/install.php

<?php
session_start();

$error = '';
$message = '';
$db_config_file = '../config.php';
$sql_file = 'database.sql';
$success_redirect = 'install_success.php'; // Success page

// Check if already installed
$installed = file_exists($db_config_file);

// Handle form submission
if (isset($_POST['install_submit'])) {
    
    // --- FORM DATA ---
    $db_host = $_POST['db_host'] ?? 'localhost';
    $db_name = $_POST['db_name'] ?? '';
    $db_user = $_POST['db_user'] ?? 'root';
    $db_pass = $_POST['db_pass'] ?? '';
    $admin_user = $_POST['admin_user'] ?? 'admin';
    $admin_pass = $_POST['admin_pass'] ?? '';
    $force_reinstall = isset($_POST['force_reinstall']);

    // --- VALIDATION ---
    if (empty($db_name) || empty($admin_user) || empty($admin_pass)) {
        $error = "Database Name, Admin Username, and Admin Password are required.";
    } elseif (strlen($admin_pass) < 6) {
        $error = "Admin password must be at least 6 characters long.";
    } else {
        
        $pdo = null; // Initialize PDO
        
        try {
            // --- 1. TEST DB SERVER CONNECTION ---
            $dsn = "mysql:host=$db_host";
            $pdo = new PDO($dsn, $db_user, $db_pass, [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            ]);

            // --- 2. CHECK IF DATABASE EXISTS (USER-FRIENDLY CHECK) ---
            $stmt = $pdo->prepare("SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = ?");
            $stmt->execute([$db_name]);
            if ($stmt->fetch() === false) {
                // If database doesn't exist, throw a clear error
                throw new Exception("Database '{$db_name}' not found. Please create it first in phpMyAdmin before proceeding.");
            }
            
            // --- 3. SELECT DATABASE ---
            $pdo->exec("USE `$db_name`");
            
            // --- 4. CREATE CONFIG.PHP ---
            $config_content = "<?php
/*
 * ABIZ Global Services - Database Configuration
 * Generated by Installer
 */

\$db_host = '{$db_host}';
\$db_name = '{$db_name}';
\$db_user = '{$db_user}';
\$db_pass = '{$db_pass}';
\$dsn = \"mysql:host=\$db_host;dbname=\$db_name;charset=utf8mb4\";

try {
    \$db = new PDO(\$dsn, \$db_user, \$db_pass, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false,
    ]);
} catch (PDOException \$e) {
    die(\"Database connection failed: \" . \$e->getMessage());
}
?>";
            if (!file_put_contents($db_config_file, $config_content)) {
                throw new Exception("Error: Could not write to config.php. Please check file permissions.");
            }

            // --- 5. START PHP TRANSACTION ---
            $pdo->beginTransaction();

            // --- 6. IMPORT DATABASE STRUCTURE FROM .SQL FILE ---
            if (!$installed || $force_reinstall) {
                if (!file_exists($sql_file)) {
                    throw new Exception("Error: database.sql file not found. Make sure it's in the /install/ folder.");
                }
                $sql_query = file_get_contents($sql_file);
                if ($sql_query === false) {
                    throw new Exception("Error: Could not read the database.sql file.");
                }
                $pdo->exec($sql_query);
                
                // --- 7. CREATE ADMIN USER (with Foreign Key handling) ---
                $hashed_pass = password_hash($admin_pass, PASSWORD_DEFAULT);
                
                // Temporarily disable foreign key checks to allow clearing the admin table
                $pdo->exec("SET FOREIGN_KEY_CHECKS = 0");
                
                // Use DELETE which works with foreign key disabling.
                $pdo->exec("DELETE FROM `admin_users`"); 
                
                // Now, insert the new admin user
                $stmt = $pdo->prepare("INSERT INTO `admin_users` (username, password) VALUES (?, ?)");
                $stmt->execute([$admin_user, $hashed_pass]);
                
                // IMPORTANT: Re-enable foreign key checks
                $pdo->exec("SET FOREIGN_KEY_CHECKS = 1");
            }

            // --- 8. AUTO-UPDATE DB SCHEMA (Always run this) ---
            check_and_update_db($pdo);
            
            // --- 9. COMMIT TRANSACTION ---
            $pdo->commit();

            // --- 10. SUCCESS: SET SESSION MESSAGE AND REDIRECT (NO DELETION) ---
            $_SESSION['install_message'] = "Installation Successful! For security reasons, please DELETE the '/install/' directory from your server immediately.";
            header("Location: $success_redirect");
            exit;

        } catch (PDOException $e) { // *** THE MISSING BRACKET WAS ADDED BEFORE THIS LINE ***
            // Roll back the transaction if something failed
            if (isset($pdo) && $pdo->inTransaction()) { 
                $pdo->rollBack(); 
            }
            $error = "Database Install Error: " . $e->getMessage();
            
            // If config file was created in a failed attempt, remove it
            if (file_exists($db_config_file) && !$installed) {
                @unlink($db_config_file);
            }
        } catch (Exception $e) {
            // Catch any other general errors
            if (isset($pdo) && $pdo->inTransaction()) { 
                $pdo->rollBack(); 
            }
            $error = "An error occurred: " . $e->getMessage();
        }
    }
}

// Function to check and add missing columns for future updates
function check_and_update_db($pdo) {
    $updates = [
        'site_settings' => [
            'logo_dark' => "VARCHAR(255) DEFAULT NULL",
            'logo_light' => "VARCHAR(255) DEFAULT NULL",
            'site_url' => "VARCHAR(255) DEFAULT NULL",
            'footer_text' => "TEXT DEFAULT NULL"
        ]
    ];

    foreach ($updates as $table => $columns) {
        foreach ($columns as $column => $type) {
            try {
                // Check if column exists
                $pdo->query("SELECT `$column` FROM `$table` LIMIT 1");
            } catch (PDOException $e) {
                // If it doesn't exist, add it
                if ($e->getCode() == '42S22') { // SQLSTATE code for 'column not found'
                    $pdo->exec("ALTER TABLE `$table` ADD COLUMN `$column` $type");
                }
            }
        }
    }
}

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABIZ CMS Installer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <div class="w-full max-w-lg bg-white rounded-xl shadow-2xl overflow-hidden">
        <div class="p-8">
            <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">ABIZ CMS Installer</h1>

            <?php if ($error): ?>
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6" role="alert">
                    <strong class="font-bold">Error:</strong>
                    <span class="block sm:inline"><?php echo htmlspecialchars($error); ?></span>
                </div>
            <?php endif; ?>
            
            <?php if ($message): ?>
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6" role="alert">
                    <strong class="font-bold">Success:</strong>
                    <span class="block sm:inline"><?php echo htmlspecialchars($message); ?></span>
                </div>
            <?php endif; ?>

            <?php if ($installed && !isset($_POST['install_submit'])): ?>
                <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg mb-6" role="alert">
                    <strong class="font-bold">Warning:</strong>
                    <span class="block sm:inline">CMS is already installed. Re-running the installer will wipe your database.</span>
                </div>
            <?php endif; ?>

            <p class="text-center text-gray-600 mb-6">
                Fill in your database and admin details below to install the CMS.
            </p>
            
            <form action="install.php" method="POST">
                <div class="border-t border-gray-200 pt-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Database Details</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="db_host" class="block text-sm font-medium text-gray-700">DB Host</label>
                            <input type="text" name="db_host" id="db_host" value="localhost" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label for="db_name" class="block text-sm font-medium text-gray-700">DB Name (Must Exist)</label>
                            <input type="text" name="db_name" id="db_name" placeholder="e.g., agency_db" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label for="db_user" class="block text-sm font-medium text-gray-700">DB User</label>
                            <input type="text" name="db_user" id="db_user" value="root" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label for="db_pass" class="block text-sm font-medium text-gray-700">DB Password</label>
                            <input type="password" name="db_pass" id="db_pass" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-6 mt-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Admin Account</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="admin_user" class="block text-sm font-medium text-gray-700">Admin Username</label>
                            <input type="text" name="admin_user" id="admin_user" value="admin" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label for="admin_pass" class="block text-sm font-medium text-gray-700">Admin Password</label>
                            <input type="password" name="admin_pass" id="admin_pass" placeholder="Min 6 characters" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                    </div>
                </div>

                <?php if ($installed): ?>
                <div class="border-t border-gray-200 pt-6 mt-6">
                    <label class="flex items-center">
                        <input type="checkbox" name="force_reinstall" value="1" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                        <span class="ml-2 block text-sm text-red-700 font-medium">Force Re-installation (This will wipe all existing data)</span>
                    </label>
                </div>
                <?php endif; ?>

                <div class="pt-6 mt-6 border-t border-gray-200">
                    <button type="submit" name="install_submit" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        <i class="fa-solid fa-database mr-2"></i>
                        Install Now
                    </button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>

.htaccess

RewriteEngine On
RewriteBase /agency/

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

RewriteRule ^(.+)$ index.php?p=$1 [L,QSA]

index.php

<?php
include_once('config.php');

$p = $_GET['p'] ?? 'home';

// Fetch site settings
try {
    $settings_stmt = $db->query("SELECT * FROM site_settings WHERE id = 1");
    $settings = $settings_stmt->fetch(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    die("Database error: " . $e->getMessage());
}

// Simple router to include pages
function load_page($page, $settings, $db) {
    if ($page === 'home' || empty($page)) {
        require 'includes/homepage.php';
    } elseif ($page === 'services') {
        require 'includes/services.php';
    } elseif ($page === 'products') {
        require 'includes/products.php';
    } elseif ($page === 'packages') {
        require 'includes/packages.php';
    } elseif ($page === 'installment-plans') {
        require 'includes/installment_plans.php';
    } elseif ($page === 'contact') {
        require 'includes/contact.php';
    } elseif (strpos($page, 'blog/') === 0) {
        $slug = substr($page, 5);
        require 'includes/post.php';
    } elseif ($page === 'blog') {
        require 'includes/blog.php';
    } elseif (strpos($page, 'portfolio/') === 0) {
        // FIX 1: Correctly parse the ID after 'portfolio/'
        $parts = explode('/', $page);
        $id = end($parts); 
        if (is_numeric($id) && $id > 0) {
            // Set the project ID globally for case_study.php to use
            $GLOBALS['project_id'] = (int)$id; 
            require 'includes/case_study.php'; 
        } else {
             header("HTTP/1.0 404 Not Found");
             require 'includes/404.php';
        }
    } elseif ($page === 'portfolio') {
        require 'includes/portfolio.php';
    } else {
        header("HTTP/1.0 404 Not Found");
        require 'includes/404.php';
    }
}

load_page($p, $settings, $db);
?>

seed_junction.php

<?php
// Ensure this script is run only once and then deleted.
include_once('config.php');
header('Content-Type: text/plain');

try {
    $db->beginTransaction();

    // Disable Foreign Key checks temporarily
    $db->exec("SET FOREIGN_KEY_CHECKS = 0");
    
    // 1. Get all Service IDs
    $services_data = $db->query("SELECT id, name FROM services")->fetchAll(PDO::FETCH_KEY_PAIR);
    
    // 2. Map service names to IDs
    $service_map = array_flip($services_data);

    // 3. Get all Portfolio IDs
    $portfolio_data = $db->query("SELECT id, title FROM portfolio")->fetchAll(PDO::FETCH_KEY_PAIR);

    $db->exec("DELETE FROM portfolio_services_junction"); // Clear junction table

    // Define project-to-service mapping based on titles
    $mapping = [
        'E-commerce Platform Redesign' => ['Web Development', 'SEO (On-Page & Off-Page)', 'Graphics Design'],
        'SaaS Landing Page Conversion' => ['Web Development', 'SEO (On-Page & Off-Page)'],
        'Corporate B2B Website Build' => ['Web Development', 'Graphics Design'],
        'Real Estate Portal Backend' => ['Web Development', 'Python Automations'],

        'Complete Brand Identity Overhaul' => ['Graphics Design'],
        'Social Media Campaign Graphics' => ['Graphics Design', 'SMM (Social Media Marketing)'],
        'Ebook and Lead Magnet Design' => ['Graphics Design'],
        'Trade Show Booth Design' => ['Graphics Design'],

        'Local SEO Domination Strategy' => ['SEO (On-Page & Off-Page)', 'SMM (Social Media Marketing)'],
        'Off-Page Authority Building' => ['SEO (On-Page & Off-Page)'],
        'SMM Lead Generation Funnel' => ['SMM (Social Media Marketing)'],
        'Full Social Media Account Handling' => ['SMH (Social Media Handling)', 'SMO (Social Media Optimization)'],

        'Product Explainer Video' => ['Video Editing', 'Voice Over', 'Graphics Design'],
        'eLearning Course Video Editing' => ['Video Editing'],
        'Corporate Narration Voice Over' => ['Voice Over'],
        'YouTube Channel Video Production' => ['Video Editing'],
        
        'Python Data Scraping System' => ['Python Automations'],
        'Inbound Support Call Flow Optimization' => ['Call Center (Inbound)'],
        'Outbound Sales Lead Qualification' => ['Call Center (Outbound)', 'SMM (Social Media Marketing)'],
        'Cloud-based Workflow Automation' => ['Python Automations', 'Web Development'],
    ];
    
    $junction_stmt = $db->prepare("INSERT INTO portfolio_services_junction (portfolio_id, service_id) VALUES (?, ?)");

    foreach ($portfolio_data as $port_id => $port_title) {
        if (isset($mapping[$port_title])) {
            foreach ($mapping[$port_title] as $service_name) {
                if (isset($service_map[$service_name])) {
                    $service_id = $service_map[$service_name];
                    $junction_stmt->execute([$port_id, $service_id]);
                }
            }
        }
    }

    $db->commit();
    echo "SUCCESS: Portfolio and Services successfully linked.\n";
    
    // Re-enable Foreign Key checks
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");
    
} catch (PDOException $e) {
    if ($db->inTransaction()) { $db->rollBack(); } // Check before rollback
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");
    echo "ERROR: Failed to seed junction data. " . $e->getMessage() . "\n";
}
?>

seed_portfolio.php

<?php
// Ensure this script is run only once and then deleted.
include_once('config.php');
header('Content-Type: text/plain');

try {
    $db->beginTransaction();

    // Disable Foreign Key checks temporarily
    $db->exec("SET FOREIGN_KEY_CHECKS = 0");
    $db->exec("DELETE FROM portfolio"); // Changed from TRUNCATE to DELETE FROM

    $case_study_content = "<h2>Project Overview and Goal</h2><p>The client approached us with the goal of increasing their online market share by 30% within 12 months. Their existing platform was outdated, slow, and non-responsive, leading to a high bounce rate. Our primary goal was to rebuild the entire front-end on a modern stack (React/Tailwind) and implement a robust SEO strategy from the ground up to ensure long-term organic growth.</p><h2>Our Solution and Execution</h2><p>We started with a full technical SEO audit and competitive analysis. The Web Development team then executed a complete overhaul, focusing on mobile-first design and blazing-fast loading speeds (achieving a score of 95+ on Google PageSpeed Insights). Simultaneously, our SEO team implemented a strategic content plan, optimizing all service pages and blog content for high-intent keywords. We also built a custom API integration for their inventory system.</p><h2>Results and Conclusion</h2><p>Within six months, the client experienced a 45% increase in organic traffic and a 20% growth in leads directly attributable to the new website. The conversion rate improved by 15% due to the optimized user experience. The client was extremely satisfied, and we continue to manage their ongoing SEO and maintenance needs.</p>";

    $projects_data = [
        // Web Development (4 projects)
        ['E-commerce Platform Redesign', $case_study_content, 'port_ecommerce.webp', 'Client A', 'The new design is stunning and the site speed is incredible. Our conversions are up by 20%!', 5, 'E-commerce Redesign Case Study', 'Detailed case study on rebuilding an e-commerce platform for better performance.', 'ecommerce, web design, react, tailwind'],
        ['SaaS Landing Page Conversion', $case_study_content, 'port_saas.webp', 'Client B', 'ABIZ delivered a high-converting landing page in record time. Excellent communication and result-driven work.', 4, 'SaaS Landing Page Optimization', 'How we optimized a SaaS landing page for a 15% boost in trial sign-ups.', 'saas, landing page, conversion optimization'],
        ['Corporate B2B Website Build', $case_study_content, 'port_b2b.webp', 'Client C', 'Professional, sleek, and easy to manage. The B2B site perfectly captures our brand identity.', 5, 'B2B Corporate Website Development', 'Building a scalable corporate website for a major B2B logistics firm.', 'corporate website, b2b, web development, logistics'],
        ['Real Estate Portal Backend', $case_study_content, 'port_realestate.webp', 'Client D', 'The custom backend system they built is flawless. It handles thousands of listings easily.', 5, 'Real Estate Portal Case Study', 'Custom backend development and database structure for a high-traffic real estate portal.', 'real estate, backend, php, database'],
        
        // Graphics Design (4 projects)
        ['Complete Brand Identity Overhaul', $case_study_content, 'port_branding.webp', 'Client E', 'Our new logo and color palette are fantastic. It gives our brand a fresh, modern look.', 5, 'Brand Identity and Logo Design', 'Redefining brand identity for a rapidly growing tech startup.', 'logo design, branding, visual identity'],
        ['Social Media Campaign Graphics', $case_study_content, 'port_social.webp', 'Client F', 'The graphics for our Q4 campaign were highly engaging and drove excellent CTR.', 4, 'High-Impact Social Graphics', 'Designing a full set of engaging graphics for a multi-platform social campaign.', 'graphics, smm, social media'],
        ['Ebook and Lead Magnet Design', $case_study_content, 'port_ebook.webp', 'Client G', 'The professional design of our eBook increased our lead capture rate significantly.', 5, 'Ebook and Lead Magnet Design', 'Professional design of long-form content for lead generation.', 'lead magnet, ebook design, graphics'],
        ['Trade Show Booth Design', $case_study_content, 'port_tradeshow.webp', 'Client H', 'The 3D visualization and banner designs made our trade show booth stand out.', 5, '3D Trade Show Booth Design', 'Visual identity and banner design for a large industry trade show.', '3d design, visual design'],

        // SEO/SMM (4 projects)
        ['Local SEO Domination Strategy', $case_study_content, 'port_local.webp', 'Client I', 'We are now ranked #1 for all local keywords thanks to their precise SEO strategy.', 5, 'Local SEO Domination Case Study', 'Achieving top rankings for local service providers using granular SEO techniques.', 'local seo, on-page, link building'],
        ['Off-Page Authority Building', $case_study_content, 'port_authority.webp', 'Client J', 'Their link-building campaign was safe and extremely effective, boosting our domain authority.', 5, 'Off-Page SEO and Link Building', 'Safe and scalable off-page strategies to boost Domain Authority (DA).', 'off-page seo, link building, da boost'],
        ['SMM Lead Generation Funnel', $case_study_content, 'port_smm.webp', 'Client K', 'The social media funnel they implemented generates high-quality leads consistently.', 5, 'SMM Lead Generation Case Study', 'Implementing a targeted social media marketing funnel on Facebook and Instagram.', 'smm, social media, lead generation'],
        ['Full Social Media Account Handling', $case_study_content, 'port_smh.webp', 'Client L', 'Our social media engagement has doubled since ABIZ took over the handling.', 4, 'SMH Account Management Success', 'Detailed case on managing social accounts for increased organic growth.', 'social media handling, smo'],

        // Video/VO (4 projects)
        ['Product Explainer Video', $case_study_content, 'port_explainer.webp', 'Client M', 'The video editing and voice-over were superb. It clearly explained our complex product.', 5, 'Product Explainer Video Production', 'Full production and editing of a 60-second product explainer video.', 'video editing, voice over, motion graphics'],
        ['eLearning Course Video Editing', $case_study_content, 'port_elearning.webp', 'Client N', 'High-volume, professional editing for our entire 10-module eLearning course.', 5, 'E-Learning Course Post-Production', 'Fast-paced, high-volume video editing for educational content.', 'video editing, elearning'],
        ['Corporate Narration Voice Over', $case_study_content, 'port_vo.webp', 'Client O', 'The voice-over quality was excellent and matched our professional tone perfectly.', 5, 'Corporate Video Voice-Over', 'Professional voice recording and production for a corporate brand video.', 'voice over, narration'],
        ['YouTube Channel Video Production', $case_study_content, 'port_youtube.webp', 'Client P', 'They handle all our YouTube video editing, ensuring fast turnaround and high quality.', 4, 'YouTube Channel Video Editing', 'Ongoing video editing and post-production services for a tech YouTube channel.', 'video editing, youtube'],
        
        // Automation/Call Center (4 projects)
        ['Python Data Scraping System', $case_study_content, 'port_python.webp', 'Client Q', 'The Python automation script saved us 50+ manual hours a week in data entry.', 5, 'Python Data Scraper Automation', 'Building a custom Python scraper to automate data collection from competitor sites.', 'python, automation, data scraper'],
        ['Inbound Support Call Flow Optimization', $case_study_content, 'port_inbound.webp', 'Client R', 'Their guidance streamlined our inbound call center, reducing average wait time by 40%.', 5, 'Inbound Call Center Optimization', 'Optimizing call center scripts and flow for better customer service.', 'call center, inbound, support'],
        ['Outbound Sales Lead Qualification', $case_study_content, 'port_outbound.webp', 'Client S', 'The outbound team qualified over 200 high-value leads in the first month.', 5, 'Outbound Lead Qualification Campaign', 'Running a targeted outbound campaign for B2B lead qualification.', 'call center, outbound, lead generation'],
        ['Cloud-based Workflow Automation', $case_study_content, 'port_cloud.webp', 'Client T', 'Automating our CRM integration using Python and cloud functions was seamless.', 5, 'Cloud Workflow Automation', 'Integrating cloud services with legacy CRM systems using Python.', 'python, cloud, automation'],
    ];

    $stmt = $db->prepare("INSERT INTO portfolio (title, description, image_path, client_name, client_review, rating, seo_title, seo_desc, seo_keywords) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)");
    foreach ($projects_data as $data) {
        $stmt->execute($data);
    }
    
    // Re-enable Foreign Key checks
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");

    $db->commit();
    echo "SUCCESS: Portfolio data (20 projects) seeded successfully!\n";
} catch (PDOException $e) {
    if ($db->inTransaction()) { $db->rollBack(); } // Check before rollback
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");
    echo "ERROR: Failed to seed portfolio data. " . $e->getMessage() . "\n";
}
?>

seed_products.php

<?php
// Ensure this script is run only once and then deleted.
include_once('config.php');
header('Content-Type: text/plain');

try {
    $db->beginTransaction();

    // Disable Foreign Key checks temporarily
    $db->exec("SET FOREIGN_KEY_CHECKS = 0");
    $db->exec("DELETE FROM products"); // Changed from TRUNCATE to DELETE FROM

    $products_data = [
        ['Monetized YouTube Channel', 'A fully verified and monetized YouTube channel with 1K+ subs and 4K watch hours. Ready to earn.', 'DM for Price', 'yt_channel.webp'],
        ['Monetized TikTok Account', 'TikTok account with 10K+ followers and high engagement. Perfect for fast monetization.', '$450', 'tiktok_account.webp'],
        ['High Authority Facebook Page', 'A high-authority Facebook page with 50K+ real followers and blue badge eligibility.', '$800', 'fb_page.webp'],
        ['Surhsark VPN Subscription', 'Lifetime subscription to Surhsark VPN - secure, fast, and multi-region access.', '$120', 'surhsark_vpn.webp'],
        ['Advanced SEO Audit Tool', 'A custom-built, one-time purchase Python tool for deep SEO audits and competitor analysis.', '$299', 'seo_tool.webp'],
        ['LinkedIn Automation Bot', 'A powerful bot to automate connection requests, message sending, and lead generation on LinkedIn.', 'DM for Price', 'linkedin_bot.webp'],
        ['Premium Website Themes (5-Pack)', 'Five premium, fully licensed and responsive WordPress/HTML themes for various niches.', '$99', 'website_themes.webp'],
        ['Custom AI Voice Model', 'Create a unique, high-quality voice model for text-to-speech applications and voiceovers.', '$350', 'ai_voice.webp'],
        ['E-commerce Ready Dropshipping Store', 'A fully stocked, optimized dropshipping store on Shopify/WooCommerce, ready for traffic.', '$1,200', 'dropshipping.webp'],
        ['Python Data Scraper Script', 'A reusable Python script for extracting specific data from any public website (customizable).', '$150', 'data_scraper.webp'],
    ];

    $stmt = $db->prepare("INSERT INTO products (name, description, price, image_path) VALUES (?, ?, ?, ?)");
    foreach ($products_data as $data) {
        $stmt->execute($data);
    }
    
    // Re-enable Foreign Key checks
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");

    $db->commit();
    echo "SUCCESS: Products data seeded successfully!\n";
} catch (PDOException $e) {
    if ($db->inTransaction()) { $db->rollBack(); } // Check before rollback
    $db->exec("SET FOREIGN_KEY_CHECKS = 1"); 
    echo "ERROR: Failed to seed products data. " . $e->getMessage() . "\n";
}
?>

seed_services.php

<?php
// Ensure this script is run only once and then deleted.
include_once('config.php');
header('Content-Type: text/plain');

try {
    $db->beginTransaction();

    // Disable Foreign Key checks temporarily (Just in case, for safety)
    $db->exec("SET FOREIGN_KEY_CHECKS = 0");
    
    // Use DELETE FROM instead of TRUNCATE to avoid foreign key issues on some MySQL configurations
    $db->exec("DELETE FROM services"); 
    
    $services_data = [
        ['Web Development', 'Custom, scalable, and fully responsive website and web application development using modern frameworks.', 'fa-solid fa-code'],
        ['Graphics Design', 'Professional branding, logo design, visual identity, and marketing material creation.', 'fa-solid fa-palette'],
        ['SEO (On-Page & Off-Page)', 'Comprehensive Search Engine Optimization including technical audits, content optimization, and high-quality link building.', 'fa-solid fa-chart-line'],
        ['SMM (Social Media Marketing)', 'Strategic social media campaign planning, content creation, and community management across platforms.', 'fa-solid fa-share-alt'],
        ['SMO (Social Media Optimization)', 'Optimizing social profiles and content to increase organic reach and engagement.', 'fa-solid fa-thumbs-up'],
        ['SMH (Social Media Handling)', 'Complete management of all social media accounts, content scheduling, and customer interaction.', 'fa-solid fa-headset'],
        ['Voice Over', 'High-quality professional voice-over services for commercials, videos, and presentations in multiple languages.', 'fa-solid fa-microphone-alt'],
        ['Video Editing', 'Professional video post-production, motion graphics, color grading, and short-form content editing.', 'fa-solid fa-video'],
        ['Call Center (Inbound)', 'Managing incoming customer calls, providing support, technical assistance, and information.', 'fa-solid fa-phone-volume'],
        ['Call Center (Outbound)', 'Proactive customer outreach, telemarketing, lead generation, and follow-up calls.', 'fa-solid fa-bullhorn'],
        ['Python Automations', 'Developing custom Python scripts and bots for data scraping, workflow automation, and repetitive task elimination.', 'fa-brands fa-python'],
    ];

    $stmt = $db->prepare("INSERT INTO services (name, description, icon) VALUES (?, ?, ?)");
    foreach ($services_data as $data) {
        $stmt->execute($data);
    }
    
    // Clear junction table (which will automatically delete junction links via CASCADE)
    $db->exec("DELETE FROM portfolio_services_junction");
    
    // Re-enable Foreign Key checks
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");

    $db->commit();
    echo "SUCCESS: Services data seeded successfully!\n";
} catch (PDOException $e) {
    $db->rollBack();
    $db->exec("SET FOREIGN_KEY_CHECKS = 1"); // Re-enable checks even if an error occurs
    echo "ERROR: Failed to seed services data. " . $e->getMessage() . "\n";
}
?>